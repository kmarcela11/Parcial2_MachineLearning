
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio 2: Modelos de Clasificación &#8212; Machine Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Ejercicio2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ejercicio 3: Modelos de Regresión" href="Ejercicio3.html" />
    <link rel="prev" title="Ejercicio 1.2: Research" href="informe.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/uninorte.jpg" class="logo__image only-light" alt="Machine Learning - Home"/>
    <script>document.write(`<img src="_static/uninorte.jpg" class="logo__image only-dark" alt="Machine Learning - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial 2- Machine Learning
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Ejercicio1.html"><strong>Ejercicio 1.1</strong></a></li>


<li class="toctree-l1"><a class="reference internal" href="informe.html"><strong>Ejercicio 1.2: Research</strong></a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Ejercicio 2: Modelos de Clasificación</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Ejercicio3.html"><strong>Ejercicio 3: Modelos de Regresión</strong></a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kmarcela11/Parcial2_MachineLearning" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kmarcela11/Parcial2_MachineLearning/issues/new?title=Issue%20on%20page%20%2FEjercicio2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Ejercicio2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio 2: Modelos de Clasificación</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-modulos-necesarios"><strong>Librerias  y modulos necesarios</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verificar-datos"><strong>Verificar datos</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-con-y-sin-adasyn"><strong>Modelos con y sin <em><strong>ADASYN</strong></em></strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion"><strong>Hiperparametrización</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-modelos"><strong>Evaluación de modelos</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion-conjunto-de-test"><strong>Predicción Conjunto de Test</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-2-modelos-de-clasificacion">
<h1><strong>Ejercicio 2: Modelos de Clasificación</strong><a class="headerlink" href="#ejercicio-2-modelos-de-clasificacion" title="Link to this heading">#</a></h1>
<p>Considere el conjunto de datos <strong>Default Probability Prediction</strong>. Implemente la versión de clasificación para cada uno de los modelos estudiados en clases, y prediga la variable respuesta, <strong>probabilidad para la variable target (default probability)</strong>. Construya una <strong>tabla de error</strong> que contenga las métricas usuales de clasificación: <strong>precision</strong>, <strong>recall</strong>, <strong>f1-score</strong>, <strong>AUC</strong>. Además, agregue <strong>matrices de confusión</strong> (ver <code class="docutils literal notranslate"><span class="pre">confusion_matrix</span></code>) y <strong>curvas ROC</strong> (ver <code class="docutils literal notranslate"><span class="pre">plot_roc</span></code>). Inicialmente, realice un <strong>balanceo de clases</strong> usando <strong>ADASYN</strong> (Adaptive Synthetic Sampling), luego compare los resultados predictivos con o sin balanceo ADASYN. Posteriormente, realice <strong>hiperparametrización</strong> usando <strong>BayesianOptimization</strong>, <strong>GridSearchCV</strong>, y <strong>Pipeline</strong> para evaluar cada modelo, comparando los resultados en términos de <strong>tiempo de cómputo</strong>. Verifique que la <strong>validación cruzada</strong> seleccionada es la adecuada, y justifíquela. Utilice la métrica <strong>M = 0.5 · (G + D)</strong>, para seleccionar el <strong>mejor modelo de clasificación</strong> (maximizar M) (ver sección Default Probability Prediction). os resultados deben estar registrados en una <strong>tabla de error</strong> (ver Tabla 1) que resuma cada <strong>score</strong> obtenido por el modelo implementado.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>precision</p></th>
<th class="head"><p>recall</p></th>
<th class="head"><p>f1-score</p></th>
<th class="head"><p>AUC</p></th>
<th class="head"><p>M</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Clasificación Bayesiana</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
</tr>
<tr class="row-odd"><td><p>K-NN</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
</tr>
<tr class="row-even"><td><p>L1/L2 Penalty Logistic Regression</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
<td><p>···</p></td>
</tr>
</tbody>
</table>
</div>
<p>Cuadro 1: Modelo de clasificación para predicción de probabilidad de default.</p>
<section id="librerias-y-modulos-necesarios">
<h2><strong>Librerias  y modulos necesarios</strong><a class="headerlink" href="#librerias-y-modulos-necesarios" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manipulación de Datos</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Visualización de Datos</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Manejo de Archivos</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Imputación y Procesamiento de Datos</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>  <span class="c1"># Habilitar IterativeImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="kn">import</span> <span class="nn">category_encoders</span> <span class="k">as</span> <span class="nn">ce</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Manejo de Desequilibrio de Datos</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">ADASYN</span>

<span class="c1"># Modelos de Clasificación</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Métricas de Evaluación</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="c1"># División de Datos</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Búsqueda de Hiperparámetros</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Real</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">,</span> <span class="n">Integer</span>

<span class="c1"># Pipelines de Modelos</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="c1"># Utilidades Varias</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Parcial 2/DATA/data.pkl&#39;</span><span class="p">)</span>
<span class="n">test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Parcial 2/DATA/test_data.ftr&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Parcial 2/DATA/train_data.ftr&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mounted at /content/drive
</pre></div>
</div>
<div class="output text_html">
  <div id="df-37236e40-aa66-427a-9b96-8f5f93eadad6" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_ID</th>
      <th>S_2</th>
      <th>P_2</th>
      <th>D_39</th>
      <th>B_1</th>
      <th>B_2</th>
      <th>R_1</th>
      <th>S_3</th>
      <th>D_41</th>
      <th>B_3</th>
      <th>...</th>
      <th>D_137</th>
      <th>D_138</th>
      <th>D_139</th>
      <th>D_140</th>
      <th>D_141</th>
      <th>D_142</th>
      <th>D_143</th>
      <th>D_144</th>
      <th>D_145</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>2017-03-09</td>
      <td>0.938477</td>
      <td>0.001734</td>
      <td>0.008728</td>
      <td>1.006836</td>
      <td>0.009224</td>
      <td>0.124023</td>
      <td>0.008774</td>
      <td>0.004707</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.002426</td>
      <td>0.003706</td>
      <td>0.003819</td>
      <td>NaN</td>
      <td>0.000569</td>
      <td>0.000610</td>
      <td>0.002674</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>2017-04-07</td>
      <td>0.936523</td>
      <td>0.005775</td>
      <td>0.004925</td>
      <td>1.000977</td>
      <td>0.006153</td>
      <td>0.126709</td>
      <td>0.000798</td>
      <td>0.002714</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003956</td>
      <td>0.003166</td>
      <td>0.005032</td>
      <td>NaN</td>
      <td>0.009575</td>
      <td>0.005493</td>
      <td>0.009216</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>2017-05-28</td>
      <td>0.954102</td>
      <td>0.091492</td>
      <td>0.021652</td>
      <td>1.009766</td>
      <td>0.006817</td>
      <td>0.123962</td>
      <td>0.007599</td>
      <td>0.009422</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003269</td>
      <td>0.007328</td>
      <td>0.000427</td>
      <td>NaN</td>
      <td>0.003429</td>
      <td>0.006985</td>
      <td>0.002604</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>2017-06-13</td>
      <td>0.960449</td>
      <td>0.002455</td>
      <td>0.013687</td>
      <td>1.002930</td>
      <td>0.001372</td>
      <td>0.117188</td>
      <td>0.000685</td>
      <td>0.005531</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.006119</td>
      <td>0.004517</td>
      <td>0.003201</td>
      <td>NaN</td>
      <td>0.008423</td>
      <td>0.006527</td>
      <td>0.009598</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>2017-07-16</td>
      <td>0.947266</td>
      <td>0.002483</td>
      <td>0.015190</td>
      <td>1.000977</td>
      <td>0.007607</td>
      <td>0.117310</td>
      <td>0.004654</td>
      <td>0.009308</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003672</td>
      <td>0.004944</td>
      <td>0.008888</td>
      <td>NaN</td>
      <td>0.001670</td>
      <td>0.008125</td>
      <td>0.009827</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 191 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-37236e40-aa66-427a-9b96-8f5f93eadad6')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-37236e40-aa66-427a-9b96-8f5f93eadad6 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-37236e40-aa66-427a-9b96-8f5f93eadad6');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-e597d03b-e0b3-424c-8d82-a0fd32b12dd0">
  <button class="colab-df-quickchart" onclick="quickchart('df-e597d03b-e0b3-424c-8d82-a0fd32b12dd0')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-e597d03b-e0b3-424c-8d82-a0fd32b12dd0 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
</section>
<section id="verificar-datos">
<h2><strong>Verificar datos</strong><a class="headerlink" href="#verificar-datos" title="Link to this heading">#</a></h2>
<p>Verificamos que el data frame <code class="docutils literal notranslate"><span class="pre">data</span></code> no tenga variables con datos faltantes para posterior implementacion del <em><strong>ADASYN</strong></em> para el balanceo de las clases, ya que en el EDA notamos que las clases estaban desbalanceadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustar las opciones de visualización de pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las filas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las columnas</span>

<span class="c1"># Calcular el porcentaje de datos faltantes por columna</span>
<span class="n">missing_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Crear un DataFrame con el nombre de la variable y el porcentaje de datos faltantes</span>
<span class="n">missing_data_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="s1">&#39;Porcentaje de Datos Faltantes&#39;</span><span class="p">:</span> <span class="n">missing_percentage</span>
<span class="p">})</span>

<span class="c1"># Mostrar la tabla completa sin truncar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_data_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       Variable  Porcentaje de Datos Faltantes
B_36       B_36                            0.0
R_28       R_28                            0.0
S_17       S_17                            0.0
D_93       D_93                            0.0
D_69       D_69                            0.0
S_23       S_23                            0.0
D_109     D_109                            0.0
D_140     D_140                            0.0
R_22       R_22                            0.0
D_124     D_124                            0.0
D_65       D_65                            0.0
B_32       B_32                            0.0
B_41       B_41                            0.0
S_12       S_12                            0.0
D_46       D_46                            0.0
R_10       R_10                            0.0
B_40       B_40                            0.0
B_27       B_27                            0.0
B_26       B_26                            0.0
D_83       D_83                            0.0
B_31       B_31                            0.0
R_14       R_14                            0.0
D_129     D_129                            0.0
D_91       D_91                            0.0
D_51       D_51                            0.0
P_3         P_3                            0.0
B_10       B_10                            0.0
S_22       S_22                            0.0
B_6         B_6                            0.0
R_18       R_18                            0.0
R_19       R_19                            0.0
D_52       D_52                            0.0
R_6         R_6                            0.0
S_24       S_24                            0.0
D_128     D_128                            0.0
S_7         S_7                            0.0
D_61       D_61                            0.0
R_7         R_7                            0.0
B_12       B_12                            0.0
P_4         P_4                            0.0
D_144     D_144                            0.0
S_6         S_6                            0.0
S_27       S_27                            0.0
S_5         S_5                            0.0
D_94       D_94                            0.0
D_123     D_123                            0.0
R_15       R_15                            0.0
S_19       S_19                            0.0
S_3         S_3                            0.0
R_25       R_25                            0.0
D_78       D_78                            0.0
D_54       D_54                            0.0
D_71       D_71                            0.0
S_25       S_25                            0.0
S_11       S_11                            0.0
D_125     D_125                            0.0
D_41       D_41                            0.0
target   target                            0.0
</pre></div>
</div>
</div>
</div>
<p>Como vemos no hay nigun dato faltante en nuestro dataframe <strong>Data</strong> y podemos seguir con la implementacion de modelos.</p>
</section>
<section id="modelos-con-y-sin-adasyn">
<h2><strong>Modelos con y sin <em><strong>ADASYN</strong></em></strong><a class="headerlink" href="#modelos-con-y-sin-adasyn" title="Link to this heading">#</a></h2>
<p>Los modelos que se van a presentar ahora son de clasificacion por lo cual, sera una prediccion de clases en base a otras variables, entre los modelos a trabajar estan</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supongamos que tienes un dataframe &#39;df&#39; con la variable objetivo &#39;target&#39;</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>  <span class="c1"># Variables explicativas</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>  <span class="c1"># Variable objetivo</span>

<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Modelos</span>
<span class="n">bayes_model</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">logistic_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ---- SIN BALANCEO ADASYN ----</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sin ADASYN:&quot;</span><span class="p">)</span>

<span class="c1"># Clasificación Bayesiana</span>
<span class="n">bayes_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_bayes</span> <span class="o">=</span> <span class="n">bayes_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clasificación Bayesiana&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_bayes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">bayes_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># K-NN</span>
<span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_knn</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K-NN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_knn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">knn_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Regresión Logística</span>
<span class="n">logistic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_logistic</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regresión Logística con L2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logistic</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ---- CON BALANCEO ADASYN ----</span>

<span class="c1"># Aplicar ADASYN</span>
<span class="n">adasyn</span> <span class="o">=</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span> <span class="o">=</span> <span class="n">adasyn</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Con ADASYN:&quot;</span><span class="p">)</span>

<span class="c1"># Clasificación Bayesiana</span>
<span class="n">bayes_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span><span class="p">)</span>
<span class="n">y_pred_bayes_adasyn</span> <span class="o">=</span> <span class="n">bayes_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clasificación Bayesiana con ADASYN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_bayes_adasyn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">bayes_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># K-NN</span>
<span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span><span class="p">)</span>
<span class="n">y_pred_knn_adasyn</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K-NN con ADASYN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_knn_adasyn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">knn_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Regresión Logística con L2</span>
<span class="n">logistic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span><span class="p">)</span>
<span class="n">y_pred_logistic_adasyn</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regresión Logística con ADASYN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logistic_adasyn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sin ADASYN:
Clasificación Bayesiana
              precision    recall  f1-score   support

         0.0       0.85      0.90      0.87   1246075
         1.0       0.63      0.50      0.56    413361

    accuracy                           0.80   1659436
   macro avg       0.74      0.70      0.72   1659436
weighted avg       0.79      0.80      0.80   1659436

AUC: 0.8565872235996864
</pre></div>
</div>
</div>
</div>
<p>Despues de implementar el código de arriba en una maquina virtual este no mostro los siguientes parametros por cada modelo presentado de una forma mas visible las comparaciones entre los modelos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Métricas obtenidas de los modelos</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bayesian&#39;</span><span class="p">,</span> <span class="s1">&#39;K-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">]</span>
<span class="n">precision_sin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">]</span>  <span class="c1"># Sin ADASYN</span>
<span class="n">recall_sin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">]</span>
<span class="n">f1_sin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">]</span>
<span class="n">auc_sin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8566</span><span class="p">,</span> <span class="mf">0.9142</span><span class="p">,</span> <span class="mf">0.9016</span><span class="p">]</span>

<span class="n">precision_con</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>  <span class="c1"># Con ADASYN</span>
<span class="n">recall_con</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">]</span>
<span class="n">f1_con</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">0.69</span><span class="p">]</span>
<span class="n">auc_con</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8550</span><span class="p">,</span> <span class="mf">0.9161</span><span class="p">,</span> <span class="mf">0.8987</span><span class="p">]</span>

<span class="c1"># Configuración del gráfico</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">))</span>  <span class="c1"># Rango para el eje x</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>  <span class="c1"># Ancho de las barras</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ---- Gráfico para precisión, recall y f1-score ----</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">precision_sin</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Precisión Sin ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">precision_con</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Precisión Con ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">recall_sin</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">precision_sin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recall Sin ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">recall_con</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">precision_con</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recall Con ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">f1_sin</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">recall_sin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;F1-Score Sin ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightcoral&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">f1_con</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">recall_con</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;F1-Score Con ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Puntuación&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Precisión, Recall y F1-Score por Modelo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># ---- Gráfico para AUC ----</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">auc_sin</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AUC Sin ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">auc_con</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AUC Con ADASYN&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AUC&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AUC por Modelo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/155cbf0a5a2212a00ac48adc0c34008952cf3dc6d118ed5c058b1fb46998af33.png" src="_images/155cbf0a5a2212a00ac48adc0c34008952cf3dc6d118ed5c058b1fb46998af33.png" />
</div>
</div>
<p><strong>ADASYN</strong>: Mejora significativamente las métricas de precisión, recall y F1-Score para todos los modelos, lo que sugiere que ayuda a balancear el conjunto de datos y mejorar el rendimiento en la predicción de la clase minoritaria.</p>
<p><strong>AUC</strong>: Se mantiene relativamente constante, lo que indica que la capacidad de los modelos para diferenciar entre clases no cambia significativamente, aunque las otras métricas muestran mejoras evidentes con <em><strong>ADASYN</strong></em>.</p>
<p>Este codigo por cuestiones  de disponibilidad de tiempo fue ejecutado en otra hoja por su complejidad de calculo. Los print fueron capturados y puesto sobre la siguiente Grafica para ver mejor su comparacion.</p>
<p>Aqui graficamos las curvas Roc de cada uno de los modelos con y sin ADASYN de todo el conjunto de train.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>


<span class="c1"># Crear subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># ---- SIN ADASYN ----</span>

<span class="c1"># Clasificación Bayesiana sin ADASYN</span>
<span class="n">fpr_bayes</span><span class="p">,</span> <span class="n">tpr_bayes</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">bayes_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_bayes</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_bayes</span><span class="p">,</span> <span class="n">tpr_bayes</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_bayes</span><span class="p">,</span> <span class="n">tpr_bayes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Bayesian (AUC = </span><span class="si">{</span><span class="n">roc_auc_bayes</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bayesian Sin ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># K-NN sin ADASYN</span>
<span class="n">fpr_knn</span><span class="p">,</span> <span class="n">tpr_knn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_knn</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_knn</span><span class="p">,</span> <span class="n">tpr_knn</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_knn</span><span class="p">,</span> <span class="n">tpr_knn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;K-NN (AUC = </span><span class="si">{</span><span class="n">roc_auc_knn</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;K-NN Sin ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># Regresión Logística sin ADASYN</span>
<span class="n">fpr_logistic</span><span class="p">,</span> <span class="n">tpr_logistic</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_logistic</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_logistic</span><span class="p">,</span> <span class="n">tpr_logistic</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_logistic</span><span class="p">,</span> <span class="n">tpr_logistic</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Logistic (AUC = </span><span class="si">{</span><span class="n">roc_auc_logistic</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logistic Sin ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># ---- CON ADASYN ----</span>

<span class="c1"># Clasificación Bayesiana con ADASYN</span>
<span class="n">fpr_bayes_adasyn</span><span class="p">,</span> <span class="n">tpr_bayes_adasyn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">bayes_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_bayes_adasyn</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_bayes_adasyn</span><span class="p">,</span> <span class="n">tpr_bayes_adasyn</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_bayes_adasyn</span><span class="p">,</span> <span class="n">tpr_bayes_adasyn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Bayesian ADASYN (AUC = </span><span class="si">{</span><span class="n">roc_auc_bayes_adasyn</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bayesian Con ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># K-NN con ADASYN</span>
<span class="n">fpr_knn_adasyn</span><span class="p">,</span> <span class="n">tpr_knn_adasyn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_knn_adasyn</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_knn_adasyn</span><span class="p">,</span> <span class="n">tpr_knn_adasyn</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_knn_adasyn</span><span class="p">,</span> <span class="n">tpr_knn_adasyn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;K-NN ADASYN (AUC = </span><span class="si">{</span><span class="n">roc_auc_knn_adasyn</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;K-NN Con ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># Regresión Logística con ADASYN</span>
<span class="n">fpr_logistic_adasyn</span><span class="p">,</span> <span class="n">tpr_logistic_adasyn</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_logistic_adasyn</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_logistic_adasyn</span><span class="p">,</span> <span class="n">tpr_logistic_adasyn</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_logistic_adasyn</span><span class="p">,</span> <span class="n">tpr_logistic_adasyn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Logistic ADASYN (AUC = </span><span class="si">{</span><span class="n">roc_auc_logistic_adasyn</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logistic Con ADASYN&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="c1"># Ajustar los ejes</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ef5349b85d25220d9a6aa8e0b028ce1793fbfa51e9fd8a1ee545b99d4b410a38.png" src="_images/ef5349b85d25220d9a6aa8e0b028ce1793fbfa51e9fd8a1ee545b99d4b410a38.png" />
</div>
</div>
<p><em><strong>ADASYN</strong></em> no parece influir mucho en la capacidad de estos modelos para discriminar entre clases positivas y negativas, según las curvas ROC y los valores de AUC que permanecen prácticamente constantes. No obstante, como se observó en las gráficas anteriores, ADASYN tiene un impacto positivo en métricas como precisión, recall y F1-Score, mejorando la predicción de la clase minoritaria sin alterar el AUC.</p>
<p>Por ultimo implementamos el modelo de regresion logistica cambiando de L2 a L1 sin embargo pasa nada diferente en comparacion a los otros modelos de la misma forma con <em><strong>ADASYN</strong></em> mejoran los paramtros distintos al AUC, el cual permanece no muy cambiante.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supongamos que tienes un dataframe &#39;df&#39; con la variable objetivo &#39;target&#39;</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>  <span class="c1"># Variables explicativas</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>  <span class="c1"># Variable objetivo</span>


<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Crear la figura y los ejes para las gráficas</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Modelo de Regresión Logística con L1 (sin aplicar ADASYN) y n_jobs=-1 para usar todos los núcleos disponibles</span>
<span class="n">logistic_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">logistic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_logistic</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regresión Logística con L1 (sin ADASYN)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logistic</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calcular y graficar la curva ROC para el modelo original</span>
<span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ROC curve (area = </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ROC Curve - Logistic Regression L1 (sin ADASYN)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>

<span class="c1"># Aplicar ADASYN para balancear las clases en los datos de entrenamiento</span>
<span class="n">adasyn</span> <span class="o">=</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span> <span class="o">=</span> <span class="n">adasyn</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Regresión Logística con L1 (aplicando ADASYN) y n_jobs=-1 para usar todos los núcleos disponibles</span>
<span class="n">logistic_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span><span class="p">)</span>
<span class="n">y_pred_logistic_adasyn</span> <span class="o">=</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regresión Logística con ADASYN&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logistic_adasyn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AUC: </span><span class="si">{</span><span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calcular y graficar la curva ROC para el modelo con ADASYN</span>
<span class="n">fpr_adasyn</span><span class="p">,</span> <span class="n">tpr_adasyn</span><span class="p">,</span> <span class="n">thresholds_adasyn</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">logistic_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">roc_auc_adasyn</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr_adasyn</span><span class="p">,</span> <span class="n">tpr_adasyn</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr_adasyn</span><span class="p">,</span> <span class="n">tpr_adasyn</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ROC curve (area = </span><span class="si">{</span><span class="n">roc_auc_adasyn</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ROC Curve - Logistic Regression L1 (con ADASYN)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>

<span class="c1"># Mostrar las gráficas</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1271: UserWarning: &#39;n_jobs&#39; &gt; 1 does not have any effect when &#39;solver&#39; is set to &#39;liblinear&#39;. Got &#39;n_jobs&#39; = 96.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/svm/_base.py:1235: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regresión Logística con L1 (sin ADASYN)
              precision    recall  f1-score   support

         0.0       0.86      0.93      0.90   1246075
         1.0       0.73      0.55      0.63    413361

    accuracy                           0.84   1659436
   macro avg       0.79      0.74      0.76   1659436
weighted avg       0.83      0.84      0.83   1659436

AUC: 0.8946203194345038
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1271: UserWarning: &#39;n_jobs&#39; &gt; 1 does not have any effect when &#39;solver&#39; is set to &#39;liblinear&#39;. Got &#39;n_jobs&#39; = 96.
  warnings.warn(
/usr/local/lib/python3.10/dist-packages/sklearn/svm/_base.py:1235: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regresión Logística con ADASYN
              precision    recall  f1-score   support

         0.0       0.95      0.79      0.86   1246075
         1.0       0.57      0.87      0.69    413361

    accuracy                           0.81   1659436
   macro avg       0.76      0.83      0.77   1659436
weighted avg       0.85      0.81      0.82   1659436

AUC: 0.8955268359484427
</pre></div>
</div>
<img alt="_images/ba810c50f21ecfd6567f89010c55e374e20c73bd53669763c1f25e3e14fb68ca.png" src="_images/ba810c50f21ecfd6567f89010c55e374e20c73bd53669763c1f25e3e14fb68ca.png" />
</div>
</div>
</section>
<section id="hiperparametrizacion">
<h2><strong>Hiperparametrización</strong><a class="headerlink" href="#hiperparametrizacion" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">BayesianOptimization</span></code>, <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> y <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></p>
<p>Inicialmente tomamos un 30 % de los datos de train para medir la velocidad de computo de los hiperparametros para una muestra de unos aproximados 1.7 millones de datos. Esta muestra fue tomada con estratificacion y posterior implemetacion de ADASYN para el balanceo de las clases y que en el dataset la muestra sea representativa.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>  <span class="c1"># Variables explicativas</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>  <span class="c1"># Variable objetivo</span>

<span class="c1"># ------ Separar los datos en entrenamiento y prueba ------</span>
<span class="k">def</span> <span class="nf">train_test_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_to_drive</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/content/drive/MyDrive/Parcial 2/DATA/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># ------ Reducir el conjunto de datos al 30% ------</span>
<span class="k">def</span> <span class="nf">reduce_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
    <span class="n">X_sample</span><span class="p">,</span> <span class="n">y_sample</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_sample</span><span class="p">,</span> <span class="n">y_sample</span>

<span class="c1"># ------ Función para GridSearchCV ------</span>
<span class="k">def</span> <span class="nf">grid_search_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="c1"># Configuración de pipelines</span>
    <span class="n">pipeline_nb</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())])</span>
    <span class="n">pipeline_knn</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">())])</span>
    <span class="n">pipeline_lr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())])</span>

    <span class="c1"># Hiperparámetros</span>
    <span class="n">params_nb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nb__var_smoothing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">]}</span>
    <span class="n">params_knn</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;knn__weights&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="s1">&#39;knn__p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
    <span class="n">params_lr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;lr__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span> <span class="s1">&#39;lr__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;liblinear&#39;</span><span class="p">],</span> <span class="s1">&#39;lr__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">]}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reducir el conjunto de entrenamiento al 30%</span>
    <span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span> <span class="o">=</span> <span class="n">reduce_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># GaussianNB</span>
    <span class="n">start_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_nb</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_nb</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params_nb</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;GridSearchCV&#39;</span><span class="p">,</span> <span class="n">grid_nb</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_nb</span> <span class="o">-</span> <span class="n">start_nb</span><span class="p">))</span>

    <span class="c1"># K-NN</span>
    <span class="n">start_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_knn</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_knn</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params_knn</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;K-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;GridSearchCV&#39;</span><span class="p">,</span> <span class="n">grid_knn</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_knn</span> <span class="o">-</span> <span class="n">start_knn</span><span class="p">))</span>

    <span class="c1"># Logistic Regression</span>
    <span class="n">start_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_lr</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_lr</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params_lr</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;GridSearchCV&#39;</span><span class="p">,</span> <span class="n">grid_lr</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_lr</span> <span class="o">-</span> <span class="n">start_lr</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># ------ Función principal que combina ambos enfoques ------</span>
<span class="k">def</span> <span class="nf">run_all_optimizations</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># Dividir los datos</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Ejecutar GridSearchCV</span>
    <span class="n">grid_results</span> <span class="o">=</span> <span class="n">grid_search_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Crear un DataFrame para almacenar los resultados</span>
    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">,</span> <span class="s1">&#39;Método&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">,</span> <span class="s1">&#39;Tiempo de Ejecución&#39;</span><span class="p">])</span>

    <span class="c1"># Guardar en un archivo pickle</span>
    <span class="n">save_to_drive</span><span class="p">(</span><span class="n">df_results</span><span class="p">,</span> <span class="s1">&#39;resultados_hiperparametros.pkl&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_results</span>

<span class="n">df_results</span> <span class="o">=</span> <span class="n">run_all_optimizations</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</pre></div>
</div>
<div class="output text_html">
  <div id="df-f69a7b75-9937-471c-b8ab-3bdf47d437e8" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Método</th>
      <th>Mejores Hiperparámetros</th>
      <th>Tiempo de Ejecución</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GaussianNB</td>
      <td>GridSearchCV</td>
      <td>{'nb__var_smoothing': 1e-08}</td>
      <td>1927.350420</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K-NN</td>
      <td>GridSearchCV</td>
      <td>{'knn__n_neighbors': 5, 'knn__p': 2, 'knn__wei...</td>
      <td>4359.783811</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Logistic Regression</td>
      <td>GridSearchCV</td>
      <td>{'lr__C': 0.1, 'lr__max_iter': 100, 'lr__penal...</td>
      <td>3557.965975</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-f69a7b75-9937-471c-b8ab-3bdf47d437e8')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-f69a7b75-9937-471c-b8ab-3bdf47d437e8 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-f69a7b75-9937-471c-b8ab-3bdf47d437e8');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8d67ab9c-dad5-4dd6-8170-7879c614778c">
  <button class="colab-df-quickchart" onclick="quickchart('df-8d67ab9c-dad5-4dd6-8170-7879c614778c')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8d67ab9c-dad5-4dd6-8170-7879c614778c button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<p>Los parametros que nos muestran tienen la particularidad de que fueron tomados usando grid search. Podemos notar que hay una diferencia significativa en la hiperparametrizacion en base a cada modelo, siendo el mas rapido la <em>Clasificacion Bayesiana</em>.</p>
<p>Posterior a esto, tomaremos muestras mas pequeñas y compararemos el tiempo de computo para tomar hiperparametros de la muestra en cada metodo de hiperparametrizacion, comparando sus modelos y tiempos de ejecucion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------ Cargar y tomar una muestra estratificada del dataset ------</span>
<span class="k">def</span> <span class="nf">load_and_sample_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="c1"># Cargar el dataset completo</span>
    <span class="n">data</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># Dividir las observaciones por la columna target (suponiendo que &#39;target&#39; es la columna objetivo)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>  <span class="c1"># Variables explicativas</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>  <span class="c1"># Variable objetivo</span>

    <span class="c1"># Tomar una muestra estratificada de 50,000 observaciones del dataset</span>
    <span class="n">X_sample</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_sample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Combinar X_sample y y_sample nuevamente en un DataFrame</span>
    <span class="n">data_sampled</span> <span class="o">=</span> <span class="n">X_sample</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_sampled</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_sample</span>

    <span class="k">return</span> <span class="n">data_sampled</span>

<span class="c1"># ------ Separar los datos en entrenamiento y prueba ------</span>
<span class="k">def</span> <span class="nf">train_test_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># ------ Reducir el conjunto de datos al 30% ------</span>
<span class="k">def</span> <span class="nf">reduce_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
    <span class="n">sample_indices</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
    <span class="k">return</span> <span class="n">X_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample_indices</span><span class="p">],</span> <span class="n">y_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sample_indices</span><span class="p">]</span>

<span class="c1"># ------ Función para calcular la métrica M ------</span>
<span class="k">def</span> <span class="nf">defaultprob_metric</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>

    <span class="c1"># Captura del 4% superior</span>
    <span class="k">def</span> <span class="nf">top_four_percent_captured</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">20</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight_cumsum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">four_pct_cutoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.04</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">df_cutoff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight_cumsum&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">four_pct_cutoff</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df_cutoff</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Cálculo del Gini ponderado</span>
    <span class="k">def</span> <span class="nf">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">20</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">total_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cum_pos_found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lorentz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cum_pos_found&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_pos</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lorentz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Gini Normalizado</span>
    <span class="k">def</span> <span class="nf">normalized_weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">y_true_pred</span> <span class="o">=</span> <span class="n">y_true</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;prediction&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_true_pred</span><span class="p">)</span>

    <span class="c1"># Cálculo final de M</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">normalized_weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">top_four_percent_captured</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>

<span class="c1"># ------ Función para Grid Search CV ------</span>
<span class="k">def</span> <span class="nf">grid_search_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="c1"># Configuración de pipelines</span>
    <span class="n">pipeline_nb</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())])</span>
    <span class="n">pipeline_knn</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">())])</span>
    <span class="n">pipeline_lr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))])</span>

    <span class="c1"># Espacios de búsqueda para Grid Search</span>
    <span class="n">grid_params_nb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nb__var_smoothing&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">]}</span>
    <span class="n">grid_params_knn</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;knn__weights&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">],</span>
        <span class="s1">&#39;knn__p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">grid_params_lr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;lr__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">],</span>
        <span class="s1">&#39;lr__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reducir el conjunto de entrenamiento al 30%</span>
    <span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span> <span class="o">=</span> <span class="n">reduce_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Grid Search para GaussianNB</span>
    <span class="n">start_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_search_nb</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_nb</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">grid_params_nb</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search_nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;Grid Search&#39;</span><span class="p">,</span> <span class="n">grid_search_nb</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_nb</span> <span class="o">-</span> <span class="n">start_nb</span><span class="p">))</span>

    <span class="c1"># Grid Search para K-NN</span>
    <span class="n">start_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_search_knn</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_knn</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">grid_params_knn</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;K-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;Grid Search&#39;</span><span class="p">,</span> <span class="n">grid_search_knn</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_knn</span> <span class="o">-</span> <span class="n">start_knn</span><span class="p">))</span>

    <span class="c1"># Grid Search para Logistic Regression</span>
    <span class="n">start_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_search_lr</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_lr</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">grid_params_lr</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">grid_search_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Grid Search&#39;</span><span class="p">,</span> <span class="n">grid_search_lr</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_lr</span> <span class="o">-</span> <span class="n">start_lr</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># ------ Función para Bayes Search CV ------</span>
<span class="k">def</span> <span class="nf">bayesian_optimization_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">):</span>
    <span class="c1"># Configuración de pipelines</span>
    <span class="n">pipeline_nb</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;nb&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())])</span>
    <span class="n">pipeline_knn</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">())])</span>
    <span class="n">pipeline_lr</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;adasyn&#39;</span><span class="p">,</span> <span class="n">ADASYN</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))])</span>

    <span class="c1"># Espacios de búsqueda para Bayesian Optimization</span>
    <span class="n">bayes_params_nb</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nb__var_smoothing&#39;</span><span class="p">:</span> <span class="n">Real</span><span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="s1">&#39;log-uniform&#39;</span><span class="p">)}</span>
    <span class="n">bayes_params_knn</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">:</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
        <span class="s1">&#39;knn__weights&#39;</span><span class="p">:</span> <span class="n">Categorical</span><span class="p">([</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;knn__p&#39;</span><span class="p">:</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">bayes_params_lr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;lr__C&#39;</span><span class="p">:</span> <span class="n">Real</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e+6</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="s1">&#39;log-uniform&#39;</span><span class="p">),</span>
        <span class="s1">&#39;lr__penalty&#39;</span><span class="p">:</span> <span class="n">Categorical</span><span class="p">([</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;l2&#39;</span><span class="p">]),</span>
        <span class="s1">&#39;lr__max_iter&#39;</span><span class="p">:</span> <span class="n">Integer</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reducir el conjunto de entrenamiento al 30%</span>
    <span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span> <span class="o">=</span> <span class="n">reduce_data</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Bayesian Optimization para GaussianNB</span>
    <span class="n">start_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">bayes_search_nb</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline_nb</span><span class="p">,</span> <span class="n">search_spaces</span><span class="o">=</span><span class="n">bayes_params_nb</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">bayes_search_nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;Bayesian Optimization&#39;</span><span class="p">,</span> <span class="n">bayes_search_nb</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_nb</span> <span class="o">-</span> <span class="n">start_nb</span><span class="p">))</span>

    <span class="c1"># Bayesian Optimization para K-NN</span>
    <span class="n">start_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">bayes_search_knn</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline_knn</span><span class="p">,</span> <span class="n">search_spaces</span><span class="o">=</span><span class="n">bayes_params_knn</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">bayes_search_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_knn</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;K-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;Bayesian Optimization&#39;</span><span class="p">,</span> <span class="n">bayes_search_knn</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_knn</span> <span class="o">-</span> <span class="n">start_knn</span><span class="p">))</span>

    <span class="c1"># Bayesian Optimization para Logistic Regression</span>
    <span class="n">start_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">bayes_search_lr</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline_lr</span><span class="p">,</span> <span class="n">search_spaces</span><span class="o">=</span><span class="n">bayes_params_lr</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">bayes_search_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
    <span class="n">end_lr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Bayesian Optimization&#39;</span><span class="p">,</span> <span class="n">bayes_search_lr</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">end_lr</span> <span class="o">-</span> <span class="n">start_lr</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># ------ Función principal que combina ambos enfoques y guarda métricas ------</span>
<span class="k">def</span> <span class="nf">run_all_optimizations</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># Cargar los datos y tomar una muestra de 50,000 observaciones</span>
    <span class="n">data_sampled</span> <span class="o">=</span> <span class="n">load_and_sample_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="c1"># Dividir el dataset en variables explicativas y objetivo</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data_sampled</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data_sampled</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

    <span class="c1"># Dividir los datos en entrenamiento y prueba</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Ejecutar Grid Search y Bayesian Optimization</span>
    <span class="n">grid_results</span> <span class="o">=</span> <span class="n">grid_search_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">bayesian_results</span> <span class="o">=</span> <span class="n">bayesian_optimization_pipeline</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Evaluar los modelos con la métrica M en el conjunto de prueba</span>
    <span class="k">def</span> <span class="nf">evaluate_with_metric</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">defaultprob_metric</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">}))</span>

    <span class="c1"># Crear un DataFrame para almacenar los resultados</span>
    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_results</span> <span class="o">+</span> <span class="n">bayesian_results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">,</span> <span class="s1">&#39;Método&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">,</span> <span class="s1">&#39;Tiempo de Ejecución&#39;</span><span class="p">])</span>

    <span class="c1"># Guardar en un archivo pickle</span>
    <span class="n">df_results</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/resultados_modelos.pkl&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_results</span>


<span class="c1"># Ejecutar la optimización en el dataset (reemplaza &#39;ruta/del/dataset.csv&#39; con la ubicación real de tu archivo)</span>
<span class="n">df_results_b</span> <span class="o">=</span> <span class="n">run_all_optimizations</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/Parcial 2/DATA/data.pkl&#39;</span><span class="p">)</span>
<span class="n">df_results_b</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</pre></div>
</div>
<div class="output text_html">
  <div id="df-628432a0-74c6-40b0-921a-d0bf0fbf83af" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Método</th>
      <th>Mejores Hiperparámetros</th>
      <th>Tiempo de Ejecución</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GaussianNB</td>
      <td>Grid Search</td>
      <td>{'nb__var_smoothing': 1e-07}</td>
      <td>9.572442</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K-NN</td>
      <td>Grid Search</td>
      <td>{'knn__n_neighbors': 7, 'knn__p': 1, 'knn__wei...</td>
      <td>10.591176</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Logistic Regression</td>
      <td>Grid Search</td>
      <td>{'lr__C': 1, 'lr__max_iter': 100, 'lr__penalty...</td>
      <td>52.065325</td>
    </tr>
    <tr>
      <th>3</th>
      <td>GaussianNB</td>
      <td>Bayesian Optimization</td>
      <td>{'nb__var_smoothing': 8.146216961026955e-08}</td>
      <td>8.167283</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K-NN</td>
      <td>Bayesian Optimization</td>
      <td>{'knn__n_neighbors': 6, 'knn__p': 1, 'knn__wei...</td>
      <td>26.415076</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-628432a0-74c6-40b0-921a-d0bf0fbf83af')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-628432a0-74c6-40b0-921a-d0bf0fbf83af button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-628432a0-74c6-40b0-921a-d0bf0fbf83af');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-91050200-4fe1-4956-8316-fe37464981c6">
  <button class="colab-df-quickchart" onclick="quickchart('df-91050200-4fe1-4956-8316-fe37464981c6')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-91050200-4fe1-4956-8316-fe37464981c6 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_results_b</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-3a3d6d18-964d-447a-97f9-8703adb56245" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Método</th>
      <th>Mejores Hiperparámetros</th>
      <th>Tiempo de Ejecución</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GaussianNB</td>
      <td>Grid Search</td>
      <td>{'nb__var_smoothing': 1e-07}</td>
      <td>9.572442</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K-NN</td>
      <td>Grid Search</td>
      <td>{'knn__n_neighbors': 7, 'knn__p': 1, 'knn__wei...</td>
      <td>10.591176</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Logistic Regression</td>
      <td>Grid Search</td>
      <td>{'lr__C': 1, 'lr__max_iter': 100, 'lr__penalty...</td>
      <td>52.065325</td>
    </tr>
    <tr>
      <th>3</th>
      <td>GaussianNB</td>
      <td>Bayesian Optimization</td>
      <td>{'nb__var_smoothing': 8.146216961026955e-08}</td>
      <td>8.167283</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K-NN</td>
      <td>Bayesian Optimization</td>
      <td>{'knn__n_neighbors': 6, 'knn__p': 1, 'knn__wei...</td>
      <td>26.415076</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Logistic Regression</td>
      <td>Bayesian Optimization</td>
      <td>{'lr__C': 3.317697704417197, 'lr__max_iter': 4...</td>
      <td>109.494463</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-3a3d6d18-964d-447a-97f9-8703adb56245')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-3a3d6d18-964d-447a-97f9-8703adb56245 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-3a3d6d18-964d-447a-97f9-8703adb56245');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8603620a-dfbc-41b8-9c4f-7aeb15c7df3c">
  <button class="colab-df-quickchart" onclick="quickchart('df-8603620a-dfbc-41b8-9c4f-7aeb15c7df3c')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8603620a-dfbc-41b8-9c4f-7aeb15c7df3c button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<p>Notese que para la clasificacion bayesiana en terminos de velocidad de computo entre el <strong>Grid Search</strong> y la <strong>Opt. Bayesiana</strong> es muy parecida entre las 2 hiperparametrizaciones en cambio en lo que respecta a los otros 2 modelos hay una diferencia significativa de mas del doble del tiempo de ejecucion, en simplemente velocidad de computo, lo gana el <strong>Grid Search</strong>.</p>
<p>Ahora analizaremos los mejores parametros usando el conjunto de train entero en cada busqueda y los clasificaremos en una tabla con los score convencionales junto con una metrica M cuyo maximo valor es 1.</p>
</section>
<section id="evaluacion-de-modelos">
<h2><strong>Evaluación de modelos</strong><a class="headerlink" href="#evaluacion-de-modelos" title="Link to this heading">#</a></h2>
<p>Como se vio antes el conjunto de data no tenia las columnas de customer ya que para este tratamiento incial que se le dio no era estrictamente necesario, sin embargo para calcular M necesitamos manejar los <strong>“CUSTOMER-ID”</strong> y <strong>“P_2”</strong>. Por lo cual se lo agregaremos al conjunto de data para asi tener nuestro conjunto de Train completo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tomar las columnas &#39;customer_ID&#39; y &#39;P_2&#39; de df1</span>
<span class="n">df_to_add</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;P_2&#39;</span><span class="p">]]</span>

<span class="c1"># Agregar estas columnas de primero a df2</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_to_add</span><span class="p">,</span> <span class="n">data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Mostrar el resultado</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                         customer_ID       P_2      B_36  \
0  0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...  0.938477  0.009972   
1  0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...  0.936523  0.003922   
2  0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...  0.954102  0.001264   
3  0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...  0.960449  0.002729   
4  0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...  0.947266  0.009995   

       R_28      S_17      D_93      D_69      S_23     D_109     D_140  ...  \
0  0.001534  0.008034  0.003569  0.009010  0.135620  0.004326  0.003706  ...   
1  0.004932  0.000761  0.000571  0.007843  0.136353  0.008705  0.003166  ...   
2  0.009125  0.004055  0.007427  0.006023  0.134888  0.004093  0.007328  ...   
3  0.002409  0.006969  0.000664  0.005272  0.140015  0.009705  0.004517  ...   
4  0.004463  0.001770  0.003078  0.000152  0.131592  0.009117  0.004944  ...   

        S_3      R_25      D_78      D_54      D_71      S_25      S_11  \
0  0.124023  0.003647  0.001575  1.001953  0.119385  0.974609  0.401611   
1  0.126709  0.008850  0.009895  1.008789  0.140625  0.975586  0.406250   
2  0.123962  0.009766  0.009628  1.008789  0.075867  0.974121  0.406738   
3  0.117188  0.004856  0.008568  1.007812  0.150269  0.975586  0.405273   
4  0.117310  0.002983  0.003288  1.003906  0.096436  0.978027  0.487549   

      D_125      D_41  target  
0  0.008743  0.008774     0.0  
1  0.000755  0.000798     0.0  
2  0.009621  0.007599     0.0  
3  0.004650  0.000685     0.0  
4  0.000097  0.004654     0.0  

[5 rows x 60 columns]
</pre></div>
</div>
</div>
</div>
<p>Al concatenar nos dimos cuenta que la columna P_2 tiene valores faltantes por lo cual tambien se Imputo usando el iterative con el.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p2_values</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="s1">&#39;P_2&#39;</span><span class="p">]]</span>

    <span class="c1"># Inicializar el Iterative Imputer</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Imputar solo la columna &#39;P_2&#39;</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;P_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">p2_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Despues de imputada la columna <strong>P_2</strong> Procedemos a buscar las metricas de los modelos con sus respectivos hiperparametros. Para la Eleccion del mejor modelo y hacer predecir el conjunto de test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------ Cargar el dataset único con &#39;P_2&#39;, &#39;customer_ID&#39;, y &#39;target&#39; ------</span>
<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># El dataset ya se pasa como parámetro</span>

    <span class="c1"># Agrupar por customer_ID para obtener el promedio de P_2</span>
    <span class="n">ave_p2</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ave_p2</span> <span class="o">=</span> <span class="n">ave_p2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;P_2&#39;</span><span class="p">:</span> <span class="s1">&#39;prediction&#39;</span><span class="p">})</span>

    <span class="c1"># Escalar la media de P_2</span>
    <span class="n">ave_p2</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">ave_p2</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">ave_p2</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># Obtener las etiquetas verdaderas</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">ave_p2</span>

<span class="c1"># ------ Función para calcular la métrica M con &#39;P_2&#39; ------</span>
<span class="k">def</span> <span class="nf">defaultprob_metric_p2</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="c1"># Captura del 4% superior</span>
    <span class="k">def</span> <span class="nf">top_four_percent_captured</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">20</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight_cumsum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">four_pct_cutoff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.04</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">df_cutoff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight_cumsum&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">four_pct_cutoff</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df_cutoff</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Cálculo del Gini ponderado</span>
    <span class="k">def</span> <span class="nf">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">20</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">total_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cum_pos_found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lorentz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cum_pos_found&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_pos</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;lorentz&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Gini Normalizado</span>
    <span class="k">def</span> <span class="nf">normalized_weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">y_true_pred</span> <span class="o">=</span> <span class="n">y_true</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;prediction&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_true_pred</span><span class="p">)</span>

    <span class="c1"># Cálculo final de M</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">normalized_weighted_gini</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">top_four_percent_captured</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>

<span class="c1"># ------ Crear modelos ajustados manualmente con los hiperparámetros del archivo pickle ------</span>
<span class="k">def</span> <span class="nf">create_models_from_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">):</span>
    <span class="c1"># Cargar el archivo pickle</span>
    <span class="n">df_resultados_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>

    <span class="c1"># Extraer los mejores hiperparámetros para cada modelo</span>
    <span class="n">best_params_nb</span> <span class="o">=</span> <span class="n">df_resultados_modelos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_resultados_modelos</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">best_params_knn</span> <span class="o">=</span> <span class="n">df_resultados_modelos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_resultados_modelos</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;K-NN&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">best_params_lr</span> <span class="o">=</span> <span class="n">df_resultados_modelos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_resultados_modelos</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Crear los modelos ajustados con los hiperparámetros y usar todos los núcleos</span>
    <span class="n">nb_model</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">(</span><span class="n">var_smoothing</span><span class="o">=</span><span class="n">best_params_nb</span><span class="p">[</span><span class="s1">&#39;nb__var_smoothing&#39;</span><span class="p">])</span>
    <span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">best_params_knn</span><span class="p">[</span><span class="s1">&#39;knn__n_neighbors&#39;</span><span class="p">],</span>
                                     <span class="n">weights</span><span class="o">=</span><span class="n">best_params_knn</span><span class="p">[</span><span class="s1">&#39;knn__weights&#39;</span><span class="p">],</span>
                                     <span class="n">p</span><span class="o">=</span><span class="n">best_params_knn</span><span class="p">[</span><span class="s1">&#39;knn__p&#39;</span><span class="p">],</span>
                                     <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Usar todos los núcleos</span>
    <span class="n">lr_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">best_params_lr</span><span class="p">[</span><span class="s1">&#39;lr__C&#39;</span><span class="p">],</span>
                                  <span class="n">penalty</span><span class="o">=</span><span class="n">best_params_lr</span><span class="p">[</span><span class="s1">&#39;lr__penalty&#39;</span><span class="p">],</span>
                                  <span class="n">max_iter</span><span class="o">=</span><span class="n">best_params_lr</span><span class="p">[</span><span class="s1">&#39;lr__max_iter&#39;</span><span class="p">],</span>
                                  <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span>
                                  <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Usar todos los núcleos</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;GaussianNB&#39;</span><span class="p">:</span> <span class="n">nb_model</span><span class="p">,</span>
        <span class="s1">&#39;K-NN&#39;</span><span class="p">:</span> <span class="n">knn_model</span><span class="p">,</span>
        <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">:</span> <span class="n">lr_model</span>
    <span class="p">}</span>

<span class="c1"># ------ Función para evaluar los modelos y calcular las métricas convencionales y Métrica M ------</span>
<span class="k">def</span> <span class="nf">evaluate_models_with_metrics</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entrenando y evaluando el modelo: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> con los siguientes hiperparámetros:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>  <span class="c1"># Mostrar los hiperparámetros del modelo</span>

        <span class="c1"># Ajustar los modelos</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>  <span class="c1"># Fitting is included</span>

        <span class="c1"># Predicciones y probabilidades</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">y_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Calcular las métricas convencionales</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>

        <span class="c1"># Calcular la métrica M usando las probabilidades</span>
        <span class="n">m_metric</span> <span class="o">=</span> <span class="n">defaultprob_metric_p2</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">y_proba</span><span class="p">}))</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
            <span class="s1">&#39;Precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s1">&#39;Recall&#39;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
            <span class="s1">&#39;F1-Score&#39;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
            <span class="s1">&#39;AUC&#39;</span><span class="p">:</span> <span class="n">auc</span><span class="p">,</span>
            <span class="s1">&#39;Métrica M&#39;</span><span class="p">:</span> <span class="n">m_metric</span>
        <span class="p">})</span>

        <span class="c1"># Imprimir las métricas calculadas</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finalizadas las métricas del modelo: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">, Recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">, F1-Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">, AUC: </span><span class="si">{</span><span class="n">auc</span><span class="si">}</span><span class="s2">, Métrica M: </span><span class="si">{</span><span class="n">m_metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># ------ Función principal para cargar el dataset, ajustar los modelos y calcular las métricas ------</span>
<span class="k">def</span> <span class="nf">run_evaluation_pipeline</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">pickle_path</span><span class="p">):</span>
    <span class="c1"># Separar variables explicativas (X) y objetivo (y)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_ID&#39;</span><span class="p">])</span>  <span class="c1"># Excluir customer_ID</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

    <span class="c1"># Cargar los modelos ajustados con los mejores hiperparámetros</span>
    <span class="n">models</span> <span class="o">=</span> <span class="n">create_models_from_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>

    <span class="c1"># Evaluar los modelos con las métricas convencionales y la Métrica M</span>
    <span class="n">df_scores</span> <span class="o">=</span> <span class="n">evaluate_models_with_metrics</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

    <span class="c1"># Mostrar las métricas finales</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_scores</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_scores</span>

<span class="c1"># ------ Ejecutar todo el proceso ------</span>
<span class="n">pickle_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/resultados_modelos.pkl&#39;</span>  <span class="c1"># Ruta al archivo pickle con los hiperparámetros</span>

<span class="c1"># Ejecutar la evaluación completa</span>
<span class="n">df_scores</span> <span class="o">=</span> <span class="n">run_evaluation_pipeline</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">pickle_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entrenando y evaluando el modelo: GaussianNB con los siguientes hiperparámetros:
{&#39;priors&#39;: None, &#39;var_smoothing&#39;: 1e-07}
Finalizadas las métricas del modelo: GaussianNB
Precision: 0.6355568539051497, Recall: 0.5289530427058015, F1-Score: 0.5773754824480793, AUC: 0.8690854520595388, Métrica M: 0.5060310908904844
----------
Entrenando y evaluando el modelo: K-NN con los siguientes hiperparámetros:
{&#39;algorithm&#39;: &#39;auto&#39;, &#39;leaf_size&#39;: 30, &#39;metric&#39;: &#39;minkowski&#39;, &#39;metric_params&#39;: None, &#39;n_jobs&#39;: -1, &#39;n_neighbors&#39;: 7, &#39;p&#39;: 1, &#39;weights&#39;: &#39;distance&#39;}
</pre></div>
</div>
</div>
</div>
<p>Por la cantidad de Informacion que hay en el print y la gran carga computacional que genera esto al Probarlo con el conjunto de Train con los datos completos. Procedimos a ejecutar esta parte en una maquina virtual y obtuvimos los Siguientes parametros:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>precision</p></th>
<th class="head"><p>recall</p></th>
<th class="head"><p>f1-score</p></th>
<th class="head"><p>AUC</p></th>
<th class="head"><p>M</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Clasificación Bayesiana</p></td>
<td><p>0.6356</p></td>
<td><p>0.5289</p></td>
<td><p>0.5773</p></td>
<td><p>0.8690</p></td>
<td><p>0.5060</p></td>
</tr>
<tr class="row-odd"><td><p>K-NN</p></td>
<td><p>0,5118</p></td>
<td><p>0.9345</p></td>
<td><p>0.6432</p></td>
<td><p>0.8234</p></td>
<td><p>0.4785</p></td>
</tr>
<tr class="row-even"><td><p><strong>L1/L2 Penalty Logistic Regression</strong></p></td>
<td><p>0,6115</p></td>
<td><p>0.8567</p></td>
<td><p>0.7202</p></td>
<td><p>0.8509</p></td>
<td><p>0.4815</p></td>
</tr>
</tbody>
</table>
</div>
<p><em>Cuadro 1:  El mejor modelo de clasificación para predicción de probabilidad de default.(Entre GridSearch y optbayesiano)</em></p>
<p>Notemos que el enunciado nos sugiere que tomemos al modelo con el mejor paramtreo M, en este caso seria clasficicacion bayesiana con el mejor hiperparametro de grid search, este es el que usaremos para el conjunto de test con un M: <strong>0.5060</strong></p>
</section>
<section id="prediccion-conjunto-de-test">
<h2><strong>Predicción Conjunto de Test</strong><a class="headerlink" href="#prediccion-conjunto-de-test" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-b5c4f5d3-7aba-485a-ae38-f908620badb6" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_ID</th>
      <th>P_2</th>
      <th>B_36</th>
      <th>R_28</th>
      <th>S_17</th>
      <th>D_93</th>
      <th>D_69</th>
      <th>S_23</th>
      <th>D_109</th>
      <th>D_140</th>
      <th>R_22</th>
      <th>D_124</th>
      <th>D_65</th>
      <th>B_32</th>
      <th>B_41</th>
      <th>S_12</th>
      <th>D_46</th>
      <th>R_10</th>
      <th>B_40</th>
      <th>B_27</th>
      <th>B_26</th>
      <th>D_83</th>
      <th>B_31</th>
      <th>R_14</th>
      <th>D_129</th>
      <th>D_91</th>
      <th>D_51</th>
      <th>P_3</th>
      <th>B_10</th>
      <th>S_22</th>
      <th>B_6</th>
      <th>R_18</th>
      <th>R_19</th>
      <th>D_52</th>
      <th>R_6</th>
      <th>S_24</th>
      <th>D_128</th>
      <th>S_7</th>
      <th>D_61</th>
      <th>R_7</th>
      <th>B_12</th>
      <th>P_4</th>
      <th>D_144</th>
      <th>S_6</th>
      <th>S_27</th>
      <th>S_5</th>
      <th>D_94</th>
      <th>D_123</th>
      <th>R_15</th>
      <th>S_19</th>
      <th>S_3</th>
      <th>R_25</th>
      <th>D_78</th>
      <th>D_54</th>
      <th>D_71</th>
      <th>S_25</th>
      <th>S_11</th>
      <th>D_125</th>
      <th>D_41</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>0.938477</td>
      <td>0.009972</td>
      <td>0.001534</td>
      <td>0.008034</td>
      <td>0.003569</td>
      <td>0.009010</td>
      <td>0.135620</td>
      <td>0.004326</td>
      <td>0.003706</td>
      <td>0.007481</td>
      <td>0.686523</td>
      <td>0.007126</td>
      <td>0.006626</td>
      <td>0.006805</td>
      <td>0.271973</td>
      <td>0.358643</td>
      <td>0.007122</td>
      <td>0.210083</td>
      <td>0.002310</td>
      <td>0.000272</td>
      <td>0.007042</td>
      <td>1.0</td>
      <td>0.000438</td>
      <td>1.000000</td>
      <td>1.503906</td>
      <td>1.335938</td>
      <td>0.736328</td>
      <td>0.096191</td>
      <td>0.894043</td>
      <td>0.063904</td>
      <td>0.008911</td>
      <td>0.005177</td>
      <td>0.207275</td>
      <td>0.008362</td>
      <td>0.911133</td>
      <td>1.007812</td>
      <td>0.161377</td>
      <td>0.308350</td>
      <td>0.007561</td>
      <td>0.148315</td>
      <td>0.007553</td>
      <td>0.000610</td>
      <td>0.008324</td>
      <td>0.676758</td>
      <td>0.023376</td>
      <td>0.008873</td>
      <td>0.003057</td>
      <td>0.006451</td>
      <td>0.002537</td>
      <td>0.124023</td>
      <td>0.003647</td>
      <td>0.001575</td>
      <td>1.001953</td>
      <td>0.119385</td>
      <td>0.974609</td>
      <td>0.401611</td>
      <td>0.008743</td>
      <td>0.008774</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>0.936523</td>
      <td>0.003922</td>
      <td>0.004932</td>
      <td>0.000761</td>
      <td>0.000571</td>
      <td>0.007843</td>
      <td>0.136353</td>
      <td>0.008705</td>
      <td>0.003166</td>
      <td>0.006828</td>
      <td>0.686523</td>
      <td>0.002413</td>
      <td>0.001854</td>
      <td>0.004406</td>
      <td>0.188965</td>
      <td>0.353516</td>
      <td>0.005966</td>
      <td>0.184082</td>
      <td>0.001327</td>
      <td>0.000978</td>
      <td>0.007790</td>
      <td>1.0</td>
      <td>0.004311</td>
      <td>1.008789</td>
      <td>1.503906</td>
      <td>1.339844</td>
      <td>0.720703</td>
      <td>0.099792</td>
      <td>0.902344</td>
      <td>0.065247</td>
      <td>0.005905</td>
      <td>0.008980</td>
      <td>0.202759</td>
      <td>0.004028</td>
      <td>0.919922</td>
      <td>1.003906</td>
      <td>0.140991</td>
      <td>0.265137</td>
      <td>0.005302</td>
      <td>0.143555</td>
      <td>0.004833</td>
      <td>0.005493</td>
      <td>0.002481</td>
      <td>0.822266</td>
      <td>0.030594</td>
      <td>0.000391</td>
      <td>0.001306</td>
      <td>0.002333</td>
      <td>0.008430</td>
      <td>0.126709</td>
      <td>0.008850</td>
      <td>0.009895</td>
      <td>1.008789</td>
      <td>0.140625</td>
      <td>0.975586</td>
      <td>0.406250</td>
      <td>0.000755</td>
      <td>0.000798</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>0.954102</td>
      <td>0.001264</td>
      <td>0.009125</td>
      <td>0.004055</td>
      <td>0.007427</td>
      <td>0.006023</td>
      <td>0.134888</td>
      <td>0.004093</td>
      <td>0.007328</td>
      <td>0.009819</td>
      <td>0.689941</td>
      <td>0.001878</td>
      <td>0.008690</td>
      <td>0.003222</td>
      <td>0.495361</td>
      <td>0.334717</td>
      <td>0.005447</td>
      <td>0.154785</td>
      <td>0.007626</td>
      <td>0.006149</td>
      <td>0.004093</td>
      <td>1.0</td>
      <td>0.007141</td>
      <td>1.006836</td>
      <td>1.502930</td>
      <td>1.336914</td>
      <td>0.738281</td>
      <td>0.134033</td>
      <td>0.939453</td>
      <td>0.066956</td>
      <td>0.008881</td>
      <td>0.002016</td>
      <td>0.206665</td>
      <td>0.006840</td>
      <td>0.958496</td>
      <td>1.007812</td>
      <td>0.112244</td>
      <td>0.212158</td>
      <td>0.001422</td>
      <td>0.136963</td>
      <td>0.006561</td>
      <td>0.006985</td>
      <td>0.000530</td>
      <td>0.853516</td>
      <td>0.048370</td>
      <td>0.009232</td>
      <td>0.003956</td>
      <td>0.008362</td>
      <td>0.007328</td>
      <td>0.123962</td>
      <td>0.009766</td>
      <td>0.009628</td>
      <td>1.008789</td>
      <td>0.075867</td>
      <td>0.974121</td>
      <td>0.406738</td>
      <td>0.009621</td>
      <td>0.007599</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>0.960449</td>
      <td>0.002729</td>
      <td>0.002409</td>
      <td>0.006969</td>
      <td>0.000664</td>
      <td>0.005272</td>
      <td>0.140015</td>
      <td>0.009705</td>
      <td>0.004517</td>
      <td>0.000458</td>
      <td>0.687988</td>
      <td>0.005898</td>
      <td>0.002478</td>
      <td>0.007702</td>
      <td>0.508789</td>
      <td>0.323242</td>
      <td>0.001888</td>
      <td>0.153931</td>
      <td>0.000034</td>
      <td>0.009193</td>
      <td>0.008820</td>
      <td>1.0</td>
      <td>0.008690</td>
      <td>1.007812</td>
      <td>1.503906</td>
      <td>1.339844</td>
      <td>0.741699</td>
      <td>0.134399</td>
      <td>0.913086</td>
      <td>0.083740</td>
      <td>0.008347</td>
      <td>0.003910</td>
      <td>0.208252</td>
      <td>0.008186</td>
      <td>0.926270</td>
      <td>1.003906</td>
      <td>0.102844</td>
      <td>0.204346</td>
      <td>0.006363</td>
      <td>0.129028</td>
      <td>0.009560</td>
      <td>0.006527</td>
      <td>0.000783</td>
      <td>0.844727</td>
      <td>0.030060</td>
      <td>0.003201</td>
      <td>0.005135</td>
      <td>0.007362</td>
      <td>0.007053</td>
      <td>0.117188</td>
      <td>0.004856</td>
      <td>0.008568</td>
      <td>1.007812</td>
      <td>0.150269</td>
      <td>0.975586</td>
      <td>0.405273</td>
      <td>0.004650</td>
      <td>0.000685</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0000099d6bd597052cdcda90ffabf56573fe9d7c79be5f...</td>
      <td>0.947266</td>
      <td>0.009995</td>
      <td>0.004463</td>
      <td>0.001770</td>
      <td>0.003078</td>
      <td>0.000152</td>
      <td>0.131592</td>
      <td>0.009117</td>
      <td>0.004944</td>
      <td>0.003342</td>
      <td>0.688965</td>
      <td>0.009476</td>
      <td>0.002199</td>
      <td>0.009827</td>
      <td>0.216553</td>
      <td>0.230957</td>
      <td>0.006111</td>
      <td>0.120728</td>
      <td>0.002110</td>
      <td>0.005737</td>
      <td>0.001844</td>
      <td>1.0</td>
      <td>0.007812</td>
      <td>1.007812</td>
      <td>1.509766</td>
      <td>1.341797</td>
      <td>0.691895</td>
      <td>0.121521</td>
      <td>0.920898</td>
      <td>0.075928</td>
      <td>0.002678</td>
      <td>0.003431</td>
      <td>0.205444</td>
      <td>0.008606</td>
      <td>0.933594</td>
      <td>1.004883</td>
      <td>0.094299</td>
      <td>0.175659</td>
      <td>0.004829</td>
      <td>0.129517</td>
      <td>0.008156</td>
      <td>0.008125</td>
      <td>0.006699</td>
      <td>0.811035</td>
      <td>0.054230</td>
      <td>0.003845</td>
      <td>0.002850</td>
      <td>0.002470</td>
      <td>0.007729</td>
      <td>0.117310</td>
      <td>0.002983</td>
      <td>0.003288</td>
      <td>1.003906</td>
      <td>0.096436</td>
      <td>0.978027</td>
      <td>0.487549</td>
      <td>0.000097</td>
      <td>0.004654</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-b5c4f5d3-7aba-485a-ae38-f908620badb6')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-b5c4f5d3-7aba-485a-ae38-f908620badb6 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-b5c4f5d3-7aba-485a-ae38-f908620badb6');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-267e9b3e-4608-4086-bb4a-e8b0ccb7d8fb">
  <button class="colab-df-quickchart" onclick="quickchart('df-267e9b3e-4608-4086-bb4a-e8b0ccb7d8fb')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-267e9b3e-4608-4086-bb4a-e8b0ccb7d8fb button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-14fcd39b-fbd7-4276-8312-3927791c9410" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_ID</th>
      <th>S_2</th>
      <th>P_2</th>
      <th>D_39</th>
      <th>B_1</th>
      <th>B_2</th>
      <th>R_1</th>
      <th>S_3</th>
      <th>D_41</th>
      <th>B_3</th>
      <th>D_42</th>
      <th>D_43</th>
      <th>D_44</th>
      <th>B_4</th>
      <th>D_45</th>
      <th>B_5</th>
      <th>R_2</th>
      <th>D_46</th>
      <th>D_47</th>
      <th>D_48</th>
      <th>D_49</th>
      <th>B_6</th>
      <th>B_7</th>
      <th>B_8</th>
      <th>D_50</th>
      <th>D_51</th>
      <th>B_9</th>
      <th>R_3</th>
      <th>D_52</th>
      <th>P_3</th>
      <th>B_10</th>
      <th>D_53</th>
      <th>S_5</th>
      <th>B_11</th>
      <th>S_6</th>
      <th>D_54</th>
      <th>R_4</th>
      <th>S_7</th>
      <th>B_12</th>
      <th>S_8</th>
      <th>D_55</th>
      <th>D_56</th>
      <th>B_13</th>
      <th>R_5</th>
      <th>D_58</th>
      <th>S_9</th>
      <th>B_14</th>
      <th>D_59</th>
      <th>D_60</th>
      <th>D_61</th>
      <th>B_15</th>
      <th>S_11</th>
      <th>D_62</th>
      <th>D_63</th>
      <th>D_64</th>
      <th>D_65</th>
      <th>B_16</th>
      <th>B_17</th>
      <th>B_18</th>
      <th>B_19</th>
      <th>D_66</th>
      <th>B_20</th>
      <th>D_68</th>
      <th>S_12</th>
      <th>R_6</th>
      <th>S_13</th>
      <th>B_21</th>
      <th>D_69</th>
      <th>B_22</th>
      <th>D_70</th>
      <th>D_71</th>
      <th>D_72</th>
      <th>S_15</th>
      <th>B_23</th>
      <th>D_73</th>
      <th>P_4</th>
      <th>D_74</th>
      <th>D_75</th>
      <th>D_76</th>
      <th>B_24</th>
      <th>R_7</th>
      <th>D_77</th>
      <th>B_25</th>
      <th>B_26</th>
      <th>D_78</th>
      <th>D_79</th>
      <th>R_8</th>
      <th>R_9</th>
      <th>S_16</th>
      <th>D_80</th>
      <th>R_10</th>
      <th>R_11</th>
      <th>B_27</th>
      <th>D_81</th>
      <th>D_82</th>
      <th>S_17</th>
      <th>R_12</th>
      <th>B_28</th>
      <th>R_13</th>
      <th>D_83</th>
      <th>R_14</th>
      <th>R_15</th>
      <th>D_84</th>
      <th>R_16</th>
      <th>B_29</th>
      <th>B_30</th>
      <th>S_18</th>
      <th>D_86</th>
      <th>D_87</th>
      <th>R_17</th>
      <th>R_18</th>
      <th>D_88</th>
      <th>B_31</th>
      <th>S_19</th>
      <th>R_19</th>
      <th>B_32</th>
      <th>S_20</th>
      <th>R_20</th>
      <th>R_21</th>
      <th>B_33</th>
      <th>D_89</th>
      <th>R_22</th>
      <th>R_23</th>
      <th>D_91</th>
      <th>D_92</th>
      <th>D_93</th>
      <th>D_94</th>
      <th>R_24</th>
      <th>R_25</th>
      <th>D_96</th>
      <th>S_22</th>
      <th>S_23</th>
      <th>S_24</th>
      <th>S_25</th>
      <th>S_26</th>
      <th>D_102</th>
      <th>D_103</th>
      <th>D_104</th>
      <th>D_105</th>
      <th>D_106</th>
      <th>D_107</th>
      <th>B_36</th>
      <th>B_37</th>
      <th>R_26</th>
      <th>R_27</th>
      <th>B_38</th>
      <th>D_108</th>
      <th>D_109</th>
      <th>D_110</th>
      <th>D_111</th>
      <th>B_39</th>
      <th>D_112</th>
      <th>B_40</th>
      <th>S_27</th>
      <th>D_113</th>
      <th>D_114</th>
      <th>D_115</th>
      <th>D_116</th>
      <th>D_117</th>
      <th>D_118</th>
      <th>D_119</th>
      <th>D_120</th>
      <th>D_121</th>
      <th>D_122</th>
      <th>D_123</th>
      <th>D_124</th>
      <th>D_125</th>
      <th>D_126</th>
      <th>D_127</th>
      <th>D_128</th>
      <th>D_129</th>
      <th>B_41</th>
      <th>B_42</th>
      <th>D_130</th>
      <th>D_131</th>
      <th>D_132</th>
      <th>D_133</th>
      <th>R_28</th>
      <th>D_134</th>
      <th>D_135</th>
      <th>D_136</th>
      <th>D_137</th>
      <th>D_138</th>
      <th>D_139</th>
      <th>D_140</th>
      <th>D_141</th>
      <th>D_142</th>
      <th>D_143</th>
      <th>D_144</th>
      <th>D_145</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>2019-02-19</td>
      <td>0.631348</td>
      <td>0.001912</td>
      <td>0.010727</td>
      <td>0.814453</td>
      <td>0.007545</td>
      <td>0.168701</td>
      <td>0.009972</td>
      <td>0.002348</td>
      <td>0.113159</td>
      <td>NaN</td>
      <td>0.007584</td>
      <td>0.116394</td>
      <td>0.004482</td>
      <td>0.009514</td>
      <td>0.005177</td>
      <td>NaN</td>
      <td>0.474365</td>
      <td>0.626465</td>
      <td>NaN</td>
      <td>0.174561</td>
      <td>1.250977</td>
      <td>1.003906</td>
      <td>NaN</td>
      <td>0.008720</td>
      <td>0.001013</td>
      <td>0.103577</td>
      <td>0.119019</td>
      <td>NaN</td>
      <td>-0.002918</td>
      <td>NaN</td>
      <td>0.002771</td>
      <td>0.004417</td>
      <td>1.006836</td>
      <td>1.004883</td>
      <td>0.002810</td>
      <td>0.105591</td>
      <td>0.119202</td>
      <td>0.321777</td>
      <td>0.114563</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003420</td>
      <td>0.205933</td>
      <td>NaN</td>
      <td>0.010185</td>
      <td>NaN</td>
      <td>0.027466</td>
      <td>0.588867</td>
      <td>0.010490</td>
      <td>1.881836</td>
      <td>0.051819</td>
      <td>CR</td>
      <td></td>
      <td>0.008293</td>
      <td>0.008667</td>
      <td>NaN</td>
      <td>0.592285</td>
      <td>0.009148</td>
      <td>NaN</td>
      <td>0.004986</td>
      <td>NaN</td>
      <td>0.190552</td>
      <td>0.002676</td>
      <td>0.409424</td>
      <td>0.009987</td>
      <td>NaN</td>
      <td>0.005211</td>
      <td>NaN</td>
      <td>0.014687</td>
      <td>0.004311</td>
      <td>0.400635</td>
      <td>1.134766</td>
      <td>0.178833</td>
      <td>0.959473</td>
      <td>0.217651</td>
      <td>0.204590</td>
      <td>NaN</td>
      <td>0.009796</td>
      <td>0.007748</td>
      <td>0.002916</td>
      <td>0.006897</td>
      <td>0.001657</td>
      <td>0.004356</td>
      <td>NaN</td>
      <td>0.002008</td>
      <td>NaN</td>
      <td>0.002531</td>
      <td>0.000348</td>
      <td>0.001173</td>
      <td>0.004169</td>
      <td>0.004585</td>
      <td>0.002291</td>
      <td>0.508301</td>
      <td>0.005093</td>
      <td>1.002930</td>
      <td>0.133789</td>
      <td>0.004322</td>
      <td>NaN</td>
      <td>0.008858</td>
      <td>0.004143</td>
      <td>0.009560</td>
      <td>0.006943</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.003683</td>
      <td>0.009911</td>
      <td>NaN</td>
      <td>0.008911</td>
      <td>0.002954</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.009003</td>
      <td>0.003418</td>
      <td>0.002201</td>
      <td>0.003780</td>
      <td>0.002949</td>
      <td>0.004635</td>
      <td>1.003906</td>
      <td>0.006653</td>
      <td>0.007473</td>
      <td>0.000192</td>
      <td>NaN</td>
      <td>0.008759</td>
      <td>0.000834</td>
      <td>0.004391</td>
      <td>0.004116</td>
      <td>0.008446</td>
      <td>0.009575</td>
      <td>0.980957</td>
      <td>0.134888</td>
      <td>0.954590</td>
      <td>0.971191</td>
      <td>0.006561</td>
      <td>0.002419</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.008148</td>
      <td>0.007973</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>0.005123</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.003906</td>
      <td>0.274170</td>
      <td>0.004303</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.006203</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.009666</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.007080</td>
      <td>0.005959</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.004669</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.008278</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>2019-03-25</td>
      <td>0.586914</td>
      <td>0.005276</td>
      <td>0.011024</td>
      <td>0.811035</td>
      <td>0.001817</td>
      <td>0.241333</td>
      <td>0.000166</td>
      <td>0.009132</td>
      <td>0.123047</td>
      <td>NaN</td>
      <td>0.006645</td>
      <td>0.134888</td>
      <td>0.009499</td>
      <td>0.026306</td>
      <td>0.009026</td>
      <td>NaN</td>
      <td>0.473633</td>
      <td>0.611816</td>
      <td>NaN</td>
      <td>0.177124</td>
      <td>0.234131</td>
      <td>1.009766</td>
      <td>NaN</td>
      <td>0.003145</td>
      <td>0.005535</td>
      <td>0.101257</td>
      <td>0.120972</td>
      <td>NaN</td>
      <td>0.031219</td>
      <td>NaN</td>
      <td>0.006496</td>
      <td>0.010002</td>
      <td>1.005859</td>
      <td>1.000000</td>
      <td>0.000525</td>
      <td>0.160522</td>
      <td>0.121460</td>
      <td>0.170776</td>
      <td>0.184082</td>
      <td>NaN</td>
      <td>0.028351</td>
      <td>0.007156</td>
      <td>0.403320</td>
      <td>0.014488</td>
      <td>0.025131</td>
      <td>NaN</td>
      <td>0.054779</td>
      <td>0.623047</td>
      <td>0.021698</td>
      <td>2.042969</td>
      <td>0.057556</td>
      <td>CR</td>
      <td></td>
      <td>0.002012</td>
      <td>0.000835</td>
      <td>NaN</td>
      <td>0.590820</td>
      <td>0.000165</td>
      <td>NaN</td>
      <td>0.001556</td>
      <td>NaN</td>
      <td>0.190186</td>
      <td>0.001771</td>
      <td>0.561523</td>
      <td>0.008125</td>
      <td>NaN</td>
      <td>0.008392</td>
      <td>0.000606</td>
      <td>0.011948</td>
      <td>0.002283</td>
      <td>0.605957</td>
      <td>0.208374</td>
      <td>0.179443</td>
      <td>0.961426</td>
      <td>0.216553</td>
      <td>0.206543</td>
      <td>NaN</td>
      <td>0.004547</td>
      <td>0.003098</td>
      <td>NaN</td>
      <td>0.003681</td>
      <td>0.005516</td>
      <td>0.001506</td>
      <td>0.001014</td>
      <td>0.006443</td>
      <td>NaN</td>
      <td>0.007168</td>
      <td>0.003077</td>
      <td>0.005878</td>
      <td>0.004055</td>
      <td>0.009636</td>
      <td>0.001225</td>
      <td>0.508789</td>
      <td>0.007320</td>
      <td>1.003906</td>
      <td>0.144653</td>
      <td>0.005299</td>
      <td>NaN</td>
      <td>0.001477</td>
      <td>0.002083</td>
      <td>0.002234</td>
      <td>0.005524</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.006409</td>
      <td>0.007458</td>
      <td>NaN</td>
      <td>0.000843</td>
      <td>0.007458</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.005119</td>
      <td>0.002382</td>
      <td>0.006557</td>
      <td>0.001691</td>
      <td>0.004448</td>
      <td>0.000575</td>
      <td>1.004883</td>
      <td>0.004395</td>
      <td>0.001168</td>
      <td>0.006695</td>
      <td>NaN</td>
      <td>0.004318</td>
      <td>0.008072</td>
      <td>0.007889</td>
      <td>0.007656</td>
      <td>0.006348</td>
      <td>0.006950</td>
      <td>0.966797</td>
      <td>0.138550</td>
      <td>0.957031</td>
      <td>0.975098</td>
      <td>0.004612</td>
      <td>0.006550</td>
      <td>0.003031</td>
      <td>0.008759</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.004696</td>
      <td>0.000078</td>
      <td>0.015465</td>
      <td>NaN</td>
      <td>1.007812</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>0.000610</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.004883</td>
      <td>0.353760</td>
      <td>0.276611</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.003834</td>
      <td>0.008781</td>
      <td>0.005577</td>
      <td>0.007442</td>
      <td>NaN</td>
      <td>0.007599</td>
      <td>0.008072</td>
      <td>NaN</td>
      <td>0.007187</td>
      <td>0.001253</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000142</td>
      <td>0.004940</td>
      <td>0.009018</td>
      <td>NaN</td>
      <td>0.003695</td>
      <td>0.003754</td>
      <td>0.001460</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>2019-04-25</td>
      <td>0.608887</td>
      <td>0.003326</td>
      <td>0.016388</td>
      <td>1.004883</td>
      <td>0.000114</td>
      <td>0.267090</td>
      <td>0.004196</td>
      <td>0.004192</td>
      <td>0.125366</td>
      <td>NaN</td>
      <td>0.009605</td>
      <td>0.136108</td>
      <td>0.007019</td>
      <td>0.060028</td>
      <td>0.008286</td>
      <td>NaN</td>
      <td>0.471924</td>
      <td>0.622070</td>
      <td>NaN</td>
      <td>1.416992</td>
      <td>0.126953</td>
      <td>1.004883</td>
      <td>NaN</td>
      <td>0.006081</td>
      <td>0.000023</td>
      <td>0.108948</td>
      <td>0.113098</td>
      <td>NaN</td>
      <td>0.035522</td>
      <td>NaN</td>
      <td>0.003407</td>
      <td>0.004139</td>
      <td>0.006409</td>
      <td>1.007812</td>
      <td>0.004875</td>
      <td>0.210083</td>
      <td>0.120117</td>
      <td>0.172729</td>
      <td>0.253906</td>
      <td>NaN</td>
      <td>0.033722</td>
      <td>0.006023</td>
      <td>0.393799</td>
      <td>0.022949</td>
      <td>0.028870</td>
      <td>0.423584</td>
      <td>0.083740</td>
      <td>0.618164</td>
      <td>0.039337</td>
      <td>1.641602</td>
      <td>0.050659</td>
      <td>CR</td>
      <td></td>
      <td>0.008804</td>
      <td>0.006180</td>
      <td>NaN</td>
      <td>0.591309</td>
      <td>0.006096</td>
      <td>NaN</td>
      <td>0.002338</td>
      <td>NaN</td>
      <td>-0.026260</td>
      <td>0.007217</td>
      <td>0.692383</td>
      <td>0.008102</td>
      <td>NaN</td>
      <td>0.002630</td>
      <td>0.001675</td>
      <td>0.015594</td>
      <td>0.002481</td>
      <td>0.602051</td>
      <td>0.115784</td>
      <td>0.182373</td>
      <td>0.963867</td>
      <td>0.223511</td>
      <td>0.204590</td>
      <td>NaN</td>
      <td>0.004055</td>
      <td>0.008545</td>
      <td>NaN</td>
      <td>0.002390</td>
      <td>0.000776</td>
      <td>0.007587</td>
      <td>0.008682</td>
      <td>0.008286</td>
      <td>NaN</td>
      <td>0.006504</td>
      <td>0.000671</td>
      <td>0.009995</td>
      <td>0.007179</td>
      <td>0.006634</td>
      <td>0.009232</td>
      <td>0.507812</td>
      <td>0.006451</td>
      <td>1.006836</td>
      <td>0.149658</td>
      <td>0.001414</td>
      <td>NaN</td>
      <td>0.002941</td>
      <td>0.001140</td>
      <td>0.002693</td>
      <td>0.002464</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.003727</td>
      <td>0.008301</td>
      <td>NaN</td>
      <td>0.000337</td>
      <td>0.006016</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.002575</td>
      <td>0.005424</td>
      <td>0.009857</td>
      <td>0.008545</td>
      <td>0.002201</td>
      <td>0.006439</td>
      <td>1.006836</td>
      <td>0.004021</td>
      <td>0.004841</td>
      <td>0.004162</td>
      <td>NaN</td>
      <td>0.008537</td>
      <td>0.004833</td>
      <td>0.000699</td>
      <td>0.007904</td>
      <td>0.009018</td>
      <td>0.003944</td>
      <td>0.970703</td>
      <td>0.136475</td>
      <td>0.964355</td>
      <td>0.978516</td>
      <td>0.005550</td>
      <td>0.006817</td>
      <td>0.002501</td>
      <td>0.008873</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.004696</td>
      <td>0.000989</td>
      <td>0.016205</td>
      <td>NaN</td>
      <td>1.004883</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>0.006809</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.003906</td>
      <td>0.390625</td>
      <td>0.247925</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.006760</td>
      <td>0.005604</td>
      <td>0.009338</td>
      <td>0.009598</td>
      <td>NaN</td>
      <td>0.003609</td>
      <td>0.009865</td>
      <td>NaN</td>
      <td>0.008438</td>
      <td>0.001924</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000074</td>
      <td>0.002113</td>
      <td>0.004658</td>
      <td>NaN</td>
      <td>0.003155</td>
      <td>0.002155</td>
      <td>0.006481</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>2019-05-20</td>
      <td>0.614746</td>
      <td>0.009064</td>
      <td>0.021667</td>
      <td>0.816406</td>
      <td>0.009720</td>
      <td>0.188965</td>
      <td>0.004124</td>
      <td>0.015327</td>
      <td>0.123413</td>
      <td>NaN</td>
      <td>0.007820</td>
      <td>0.146606</td>
      <td>0.008949</td>
      <td>0.003401</td>
      <td>0.008308</td>
      <td>NaN</td>
      <td>0.475830</td>
      <td>0.615723</td>
      <td>NaN</td>
      <td>0.044617</td>
      <td>0.144653</td>
      <td>1.008789</td>
      <td>NaN</td>
      <td>0.004940</td>
      <td>0.007206</td>
      <td>0.100525</td>
      <td>0.120300</td>
      <td>NaN</td>
      <td>0.043152</td>
      <td>NaN</td>
      <td>0.007206</td>
      <td>0.013306</td>
      <td>0.005840</td>
      <td>1.003906</td>
      <td>0.006443</td>
      <td>0.193726</td>
      <td>0.073303</td>
      <td>0.171143</td>
      <td>0.305664</td>
      <td>NaN</td>
      <td>0.040771</td>
      <td>0.005943</td>
      <td>0.416260</td>
      <td>0.019379</td>
      <td>0.026169</td>
      <td>0.400146</td>
      <td>0.063171</td>
      <td>0.614258</td>
      <td>0.025482</td>
      <td>1.001953</td>
      <td>0.015381</td>
      <td>CR</td>
      <td></td>
      <td>0.001455</td>
      <td>0.009911</td>
      <td>NaN</td>
      <td>0.590820</td>
      <td>0.002537</td>
      <td>NaN</td>
      <td>0.006878</td>
      <td>NaN</td>
      <td>0.096741</td>
      <td>0.004032</td>
      <td>0.690918</td>
      <td>0.009125</td>
      <td>NaN</td>
      <td>0.004402</td>
      <td>0.000454</td>
      <td>0.008698</td>
      <td>0.001987</td>
      <td>0.508301</td>
      <td>0.131958</td>
      <td>0.185913</td>
      <td>0.958496</td>
      <td>0.216797</td>
      <td>0.203491</td>
      <td>NaN</td>
      <td>0.006454</td>
      <td>0.003719</td>
      <td>NaN</td>
      <td>0.004242</td>
      <td>0.006313</td>
      <td>0.004433</td>
      <td>0.007889</td>
      <td>0.006863</td>
      <td>NaN</td>
      <td>0.004078</td>
      <td>0.007267</td>
      <td>0.004757</td>
      <td>0.008957</td>
      <td>0.006115</td>
      <td>0.009567</td>
      <td>0.500488</td>
      <td>0.001257</td>
      <td>1.004883</td>
      <td>0.159790</td>
      <td>0.006111</td>
      <td>NaN</td>
      <td>0.002308</td>
      <td>0.006836</td>
      <td>0.004951</td>
      <td>0.004009</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.003363</td>
      <td>0.003571</td>
      <td>NaN</td>
      <td>0.003653</td>
      <td>0.001441</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.005077</td>
      <td>0.002619</td>
      <td>0.005238</td>
      <td>0.000531</td>
      <td>0.000277</td>
      <td>0.002878</td>
      <td>1.009766</td>
      <td>0.003136</td>
      <td>0.003860</td>
      <td>0.008369</td>
      <td>NaN</td>
      <td>0.004360</td>
      <td>0.007706</td>
      <td>0.002926</td>
      <td>0.008644</td>
      <td>0.000756</td>
      <td>0.001332</td>
      <td>0.926270</td>
      <td>0.131470</td>
      <td>0.929199</td>
      <td>0.976562</td>
      <td>0.001566</td>
      <td>0.009239</td>
      <td>0.009277</td>
      <td>0.008568</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003452</td>
      <td>0.000845</td>
      <td>0.018478</td>
      <td>NaN</td>
      <td>1.005859</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>0.006935</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.002930</td>
      <td>0.403076</td>
      <td>0.295898</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.004070</td>
      <td>0.008690</td>
      <td>0.006477</td>
      <td>0.006603</td>
      <td>NaN</td>
      <td>0.006134</td>
      <td>0.005898</td>
      <td>NaN</td>
      <td>0.002422</td>
      <td>0.006756</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.004742</td>
      <td>0.006393</td>
      <td>0.002890</td>
      <td>NaN</td>
      <td>0.006042</td>
      <td>0.005207</td>
      <td>0.007858</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>2019-06-15</td>
      <td>0.591797</td>
      <td>0.238770</td>
      <td>0.015930</td>
      <td>0.810547</td>
      <td>0.002026</td>
      <td>0.180054</td>
      <td>0.000731</td>
      <td>0.011284</td>
      <td>0.122192</td>
      <td>NaN</td>
      <td>0.009956</td>
      <td>0.135742</td>
      <td>0.008514</td>
      <td>0.141968</td>
      <td>0.002728</td>
      <td>0.442139</td>
      <td>0.479980</td>
      <td>0.591797</td>
      <td>NaN</td>
      <td>0.039581</td>
      <td>0.178223</td>
      <td>1.006836</td>
      <td>NaN</td>
      <td>0.003319</td>
      <td>0.000569</td>
      <td>0.100708</td>
      <td>0.115417</td>
      <td>0.597656</td>
      <td>0.063171</td>
      <td>NaN</td>
      <td>0.008621</td>
      <td>0.006973</td>
      <td>0.002623</td>
      <td>1.004883</td>
      <td>0.005848</td>
      <td>0.202148</td>
      <td>0.049347</td>
      <td>0.320068</td>
      <td>0.350342</td>
      <td>NaN</td>
      <td>0.063171</td>
      <td>0.001306</td>
      <td>0.398438</td>
      <td>0.011345</td>
      <td>0.009430</td>
      <td>0.401611</td>
      <td>0.024811</td>
      <td>0.592773</td>
      <td>0.016968</td>
      <td>1.082031</td>
      <td>0.020401</td>
      <td>CR</td>
      <td>U</td>
      <td>0.003040</td>
      <td>0.000131</td>
      <td>NaN</td>
      <td>0.593262</td>
      <td>0.001112</td>
      <td>NaN</td>
      <td>0.007519</td>
      <td>6.0</td>
      <td>0.116821</td>
      <td>0.003105</td>
      <td>0.691406</td>
      <td>0.009903</td>
      <td>0.007156</td>
      <td>0.000384</td>
      <td>0.005928</td>
      <td>0.009422</td>
      <td>0.000674</td>
      <td>0.402344</td>
      <td>0.153320</td>
      <td>0.184814</td>
      <td>0.962402</td>
      <td>0.214966</td>
      <td>0.201172</td>
      <td>NaN</td>
      <td>0.000208</td>
      <td>0.003138</td>
      <td>NaN</td>
      <td>0.000605</td>
      <td>0.005901</td>
      <td>0.006241</td>
      <td>0.006989</td>
      <td>0.005630</td>
      <td>NaN</td>
      <td>0.003887</td>
      <td>0.009460</td>
      <td>0.009644</td>
      <td>0.005238</td>
      <td>0.003340</td>
      <td>0.005440</td>
      <td>0.501953</td>
      <td>0.002934</td>
      <td>1.005859</td>
      <td>0.145142</td>
      <td>0.005116</td>
      <td>0.001843</td>
      <td>0.004265</td>
      <td>0.005146</td>
      <td>0.009972</td>
      <td>0.003086</td>
      <td>0.001968</td>
      <td>0.0</td>
      <td>0.006485</td>
      <td>0.008766</td>
      <td>NaN</td>
      <td>0.003521</td>
      <td>0.000117</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.009071</td>
      <td>0.002172</td>
      <td>0.007614</td>
      <td>0.008240</td>
      <td>0.007484</td>
      <td>0.000444</td>
      <td>1.001953</td>
      <td>0.004444</td>
      <td>0.005493</td>
      <td>0.009766</td>
      <td>NaN</td>
      <td>0.003006</td>
      <td>0.000445</td>
      <td>0.008522</td>
      <td>0.001574</td>
      <td>0.003849</td>
      <td>0.009163</td>
      <td>0.914062</td>
      <td>0.139648</td>
      <td>0.904785</td>
      <td>0.975586</td>
      <td>0.002411</td>
      <td>0.009544</td>
      <td>0.003092</td>
      <td>0.000221</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.003510</td>
      <td>0.001413</td>
      <td>0.015366</td>
      <td>NaN</td>
      <td>1.008789</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>0.001480</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.003906</td>
      <td>0.359863</td>
      <td>0.390869</td>
      <td>0.005623</td>
      <td>0.0</td>
      <td>0.249878</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>0.243408</td>
      <td>0.245117</td>
      <td>1.0</td>
      <td>0.19812</td>
      <td>0.14917</td>
      <td>0.003233</td>
      <td>0.009483</td>
      <td>0.007618</td>
      <td>0.0</td>
      <td>0.000031</td>
      <td>0.005302</td>
      <td>0.002028</td>
      <td>0.008995</td>
      <td>NaN</td>
      <td>0.006973</td>
      <td>0.005310</td>
      <td>NaN</td>
      <td>0.000302</td>
      <td>0.003578</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.008133</td>
      <td>0.004330</td>
      <td>0.008385</td>
      <td>NaN</td>
      <td>0.001008</td>
      <td>0.007420</td>
      <td>0.009468</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-14fcd39b-fbd7-4276-8312-3927791c9410')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-14fcd39b-fbd7-4276-8312-3927791c9410 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-14fcd39b-fbd7-4276-8312-3927791c9410');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-eaddfd16-bd88-475c-8efa-dfca644eb112">
  <button class="colab-df-quickchart" onclick="quickchart('df-eaddfd16-bd88-475c-8efa-dfca644eb112')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-eaddfd16-bd88-475c-8efa-dfca644eb112 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
<p>Notemos que el conjunto de test no tiene etiquetas las cuales seran predichas por medio de el entrenamiento del modelo con mejor parametro <strong>M</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11363762
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificar si hay columnas que no sean numéricas</span>
<span class="n">non_numeric_columns</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="nb">print</span><span class="p">(</span><span class="n">non_numeric_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;customer_ID&#39;, &#39;P_2&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Notemos que tiene 11.3 millones de datos el conjunto de test.</p>
<p>Pasamos la columna P_2 a datos numericos para evitar que haya problemas al momento de la prueba del conjunto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Ajustar las opciones de visualización de pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las filas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las columnas</span>

<span class="c1"># Calcular el porcentaje de datos faltantes por columna</span>
<span class="n">missing_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Crear un DataFrame con el nombre de la variable y el porcentaje de datos faltantes</span>
<span class="n">missing_data_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="s1">&#39;Porcentaje de Datos Faltantes&#39;</span><span class="p">:</span> <span class="n">missing_percentage</span>
<span class="p">})</span>

<span class="c1"># Mostrar la tabla completa sin truncar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_data_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Variable  Porcentaje de Datos Faltantes
customer_ID  customer_ID                       0.000000
S_2                  S_2                       0.000000
P_2                  P_2                       0.526921
D_39                D_39                       0.000000
B_1                  B_1                       0.000000
B_2                  B_2                       0.025669
R_1                  R_1                       0.000000
S_3                  S_3                      15.320323
D_41                D_41                       0.025669
B_3                  B_3                       0.025669
D_42                D_42                      88.053402
D_43                D_43                      30.030777
D_44                D_44                       4.735800
B_4                  B_4                       0.000000
D_45                D_45                       0.026206
B_5                  B_5                       0.000000
R_2                  R_2                       0.000000
D_46                D_46                      20.214723
D_47                D_47                       0.000000
D_48                D_48                      12.734656
D_49                D_49                      88.059412
B_6                  B_6                       0.027051
B_7                  B_7                       0.000000
B_8                  B_8                       0.918182
D_50                D_50                      57.047534
D_51                D_51                       0.000000
B_9                  B_9                       0.000000
R_3                  R_3                       0.000000
D_52                D_52                       0.268582
P_3                  P_3                       3.947452
B_10                B_10                       0.000000
D_53                D_53                      73.734165
S_5                  S_5                       0.000000
B_11                B_11                       0.000000
S_6                  S_6                       0.000000
D_54                D_54                       0.025669
R_4                  R_4                       0.000000
S_7                  S_7                      15.320323
B_12                B_12                       0.000000
S_8                  S_8                       0.000000
D_55                D_55                       6.538090
D_56                D_56                      50.271275
B_13                B_13                       0.514425
R_5                  R_5                       0.000000
D_58                D_58                       0.000000
S_9                  S_9                      35.070903
B_14                B_14                       0.000000
D_59                D_59                       1.464436
D_60                D_60                       0.000000
D_61                D_61                      10.913296
B_15                B_15                       0.130001
S_11                S_11                       0.000000
D_62                D_62                      16.645139
D_63                D_63                       0.000000
D_64                D_64                       0.000000
D_65                D_65                       0.000000
B_16                B_16                       0.025669
B_17                B_17                      53.909788
B_18                B_18                       0.000000
B_19                B_19                       0.025669
D_66                D_66                      88.121592
B_20                B_20                       0.025669
D_68                D_68                       3.066731
S_12                S_12                       0.020988
R_6                  R_6                       0.000000
S_13                S_13                       0.000000
B_21                B_21                       0.000000
D_69                D_69                       2.536766
B_22                B_22                       0.025669
D_70                D_70                       1.215971
D_71                D_71                       0.000000
D_72                D_72                       0.226369
S_15                S_15                       0.000000
B_23                B_23                       0.000000
D_73                D_73                      98.683737
P_4                  P_4                       0.000000
D_74                D_74                       0.357918
D_75                D_75                       0.000000
D_76                D_76                      89.519545
B_24                B_24                       0.000000
R_7                  R_7                       0.000000
D_77                D_77                      49.040318
B_25                B_25                       0.130001
B_26                B_26                       0.025669
D_78                D_78                       4.735800
D_79                D_79                       0.800325
R_8                  R_8                       0.000000
R_9                  R_9                      94.936527
S_16                S_16                       0.000000
D_80                D_80                       0.357918
R_10                R_10                       0.000000
R_11                R_11                       0.000000
B_27                B_27                       0.025669
D_81                D_81                       0.250683
D_82                D_82                      74.382242
S_17                S_17                       0.110307
R_12                R_12                       0.000000
B_28                B_28                       0.000000
R_13                R_13                       0.000000
D_83                D_83                       2.536766
R_14                R_14                       0.000000
R_15                R_15                       0.000000
D_84                D_84                       0.268582
R_16                R_16                       0.000000
B_29                B_29                      75.038205
B_30                B_30                       0.025669
S_18                S_18                       0.000000
D_86                D_86                       0.009389
D_87                D_87                      99.903447
R_17                R_17                       0.000000
R_18                R_18                       0.000000
D_88                D_88                      99.900869
B_31                B_31                       0.000000
S_19                S_19                       0.000000
R_19                R_19                       0.000000
B_32                B_32                       0.000000
S_20                S_20                       0.000000
R_20                R_20                       0.000000
R_21                R_21                       0.000000
B_33                B_33                       0.025669
D_89                D_89                       0.268582
R_22                R_22                       0.000000
R_23                R_23                       0.000000
D_91                D_91                       3.875451
D_92                D_92                       0.000000
D_93                D_93                       0.000000
D_94                D_94                       0.000000
R_24                R_24                       0.000000
R_25                R_25                       0.000000
D_96                D_96                       0.000000
S_22                S_22                       0.538624
S_23                S_23                       0.013561
S_24                S_24                       0.529367
S_25                S_25                       0.231543
S_26                S_26                       0.033140
D_102              D_102                       0.209350
D_103              D_103                       0.859750
D_104              D_104                       0.859750
D_105              D_105                      53.399578
D_106              D_106                      88.096618
D_107              D_107                       0.859750
B_36                B_36                       0.000000
B_37                B_37                       0.017776
R_26                R_26                      86.003350
R_27                R_27                       5.838771
B_38                B_38                       0.025669
D_108              D_108                      99.403587
D_109              D_109                       0.058810
D_110              D_110                      98.976624
D_111              D_111                      98.976624
B_39                B_39                      98.789213
D_112              D_112                       0.058810
B_40                B_40                       0.017626
S_27                S_27                      22.002177
D_113              D_113                       2.501293
D_114              D_114                       2.501293
D_115              D_115                       2.501293
D_116              D_116                       2.501293
D_117              D_117                       2.501293
D_118              D_118                       2.501293
D_119              D_119                       2.501293
D_120              D_120                       2.501293
D_121              D_121                       2.501293
D_122              D_122                       2.501293
D_123              D_123                       2.501293
D_124              D_124                       2.501293
D_125              D_125                       2.501293
D_126              D_126                       0.725121
D_127              D_127                       0.000000
D_128              D_128                       0.859750
D_129              D_129                       0.859750
B_41                B_41                       0.033140
B_42                B_42                      98.228421
D_130              D_130                       0.859750
D_131              D_131                       0.859750
D_132              D_132                      88.077505
D_133              D_133                       0.246344
R_28                R_28                       0.000000
D_134              D_134                      96.814039
D_135              D_135                      96.814039
D_136              D_136                      96.814039
D_137              D_137                      96.814039
D_138              D_138                      96.814039
D_139              D_139                       0.859750
D_140              D_140                       0.209024
D_141              D_141                       0.859750
D_142              D_142                      82.692395
D_143              D_143                       0.859750
D_144              D_144                       0.209790
D_145              D_145                       0.859750
</pre></div>
</div>
</div>
</div>
<p>Notemos que hay que imputar los datos de test ya que tiene columnas con datos faltantes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;P_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;P_2&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">tes</span><span class="p">[</span><span class="s1">&#39;P_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">tes</span><span class="p">[</span><span class="s1">&#39;P_2&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------ Función para seleccionar solo las columnas que están en el dataset de entrenamiento ------</span>
<span class="k">def</span> <span class="nf">select_common_columns</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">train_data</span><span class="p">):</span>
    <span class="c1"># Obtener las columnas comunes entre el conjunto de entrenamiento y el conjunto de prueba</span>
    <span class="n">common_columns</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># Asegurarse de que el conjunto de prueba solo tenga las columnas presentes en el conjunto de entrenamiento</span>
    <span class="n">test_data_common</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">common_columns</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">test_data_common</span>

<span class="c1"># ------ Función principal para procesar los conjuntos de datos ------</span>
<span class="k">def</span> <span class="nf">filter_test_columns_to_train</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># Cargar el conjunto de prueba</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">)</span>

    <span class="c1"># Seleccionar solo las columnas comunes con el conjunto de entrenamiento</span>
    <span class="n">test_data_filtered</span> <span class="o">=</span> <span class="n">select_common_columns</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>

    <span class="c1"># Guardar el conjunto de prueba filtrado en un archivo CSV</span>
    <span class="n">test_data_filtered</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El conjunto de prueba filtrado ha sido guardado en </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ------ Ejecutar todo el proceso ------</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">dataset</span>  <span class="c1"># `dataset` es el conjunto de entrenamiento ya cargado en memoria</span>
<span class="n">test_data_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/Parcial 2/DATA/test_data.ftr&#39;</span>  <span class="c1"># Ruta al archivo de conjunto de prueba en formato Feather</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/test_data_filtered.csv&#39;</span>  <span class="c1"># Ruta donde se guardará el conjunto de prueba filtrado</span>

<span class="c1"># Ejecutar el proceso</span>
<span class="n">filter_test_columns_to_train</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El conjunto de prueba filtrado ha sido guardado en /content/drive/MyDrive/test_data_filtered.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_data_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/test_data_filtered.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------ Función para aplicar Iterative Imputer solo a las columnas numéricas ------</span>
<span class="k">def</span> <span class="nf">apply_iterative_imputer</span><span class="p">(</span><span class="n">test_data_filtered_pd</span><span class="p">):</span>
    <span class="c1"># Inicializar IterativeImputer</span>
    <span class="n">imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Separar las columnas numéricas de las no numéricas</span>
    <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">test_data_filtered_pd</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;float16&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">non_numeric_columns</span> <span class="o">=</span> <span class="n">test_data_filtered_pd</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;float16&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

    <span class="c1"># Aplicar el Iterative Imputer al conjunto de datos numérico</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iniciando la imputación de variables numéricas:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Imputando la variable: </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Aplicar el Iterative Imputer a las columnas numéricas</span>
    <span class="n">imputed_data_numeric</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">test_data_filtered_pd</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="n">numeric_columns</span><span class="p">)</span>

    <span class="c1"># Volver a unir las columnas no numéricas (sin modificaciones)</span>
    <span class="n">test_data_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">test_data_filtered_pd</span><span class="p">[</span><span class="n">non_numeric_columns</span><span class="p">],</span> <span class="n">imputed_data_numeric</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">test_data_imputed</span>

<span class="c1"># ------ Función principal para cargar, imputar y guardar el dataset filtrado con Dask ------</span>
<span class="k">def</span> <span class="nf">impute_and_save_data</span><span class="p">(</span><span class="n">test_data_filtered_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># Cargar el conjunto de prueba filtrado usando Dask y convertirlo a Pandas DataFrame</span>
    <span class="n">test_data_filtered</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">test_data_filtered_path</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>  <span class="c1"># Convertir Dask DataFrame a Pandas</span>

    <span class="c1"># Verificar si hay índices duplicados y restablecer el índice</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_data_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Se encontraron índices duplicados. Restableciendo el índice.&quot;</span><span class="p">)</span>
        <span class="n">test_data_filtered</span> <span class="o">=</span> <span class="n">test_data_filtered</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Aplicar Iterative Imputer solo a las columnas numéricas</span>
    <span class="n">test_data_imputed</span> <span class="o">=</span> <span class="n">apply_iterative_imputer</span><span class="p">(</span><span class="n">test_data_filtered</span><span class="p">)</span>

    <span class="c1"># Guardar el conjunto de datos imputado en un archivo CSV</span>
    <span class="n">test_data_imputed</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El conjunto de prueba imputado ha sido guardado en </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ------ Ejecutar todo el proceso ------</span>
<span class="n">test_data_filtered_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/test_data_filtered.csv&#39;</span>  <span class="c1"># Ruta al archivo filtrado</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/test_data_imputed.csv&#39;</span>  <span class="c1"># Ruta donde se guardará el archivo imputado</span>

<span class="c1"># Ejecutar el proceso de imputación y guardado</span>
<span class="n">impute_and_save_data</span><span class="p">(</span><span class="n">test_data_filtered_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Se encontraron índices duplicados. Restableciendo el índice.
Iniciando la imputación de variables numéricas:
Imputando la variable: P_2
Imputando la variable: B_36
Imputando la variable: R_28
Imputando la variable: S_17
Imputando la variable: D_93
Imputando la variable: D_69
Imputando la variable: S_23
Imputando la variable: D_109
Imputando la variable: D_140
Imputando la variable: R_22
Imputando la variable: D_124
Imputando la variable: D_65
Imputando la variable: B_32
Imputando la variable: B_41
Imputando la variable: S_12
Imputando la variable: D_46
Imputando la variable: R_10
Imputando la variable: B_40
Imputando la variable: B_27
Imputando la variable: B_26
Imputando la variable: D_83
Imputando la variable: B_31
Imputando la variable: R_14
Imputando la variable: D_129
Imputando la variable: D_91
Imputando la variable: D_51
Imputando la variable: P_3
Imputando la variable: B_10
Imputando la variable: S_22
Imputando la variable: B_6
Imputando la variable: R_18
Imputando la variable: R_19
Imputando la variable: D_52
Imputando la variable: R_6
Imputando la variable: S_24
Imputando la variable: D_128
Imputando la variable: S_7
Imputando la variable: D_61
Imputando la variable: R_7
Imputando la variable: B_12
Imputando la variable: P_4
Imputando la variable: D_144
Imputando la variable: S_6
Imputando la variable: S_27
Imputando la variable: S_5
Imputando la variable: D_94
Imputando la variable: D_123
Imputando la variable: R_15
Imputando la variable: S_19
Imputando la variable: S_3
Imputando la variable: R_25
Imputando la variable: D_78
Imputando la variable: D_54
Imputando la variable: D_71
Imputando la variable: S_25
Imputando la variable: S_11
Imputando la variable: D_125
Imputando la variable: D_41
El conjunto de prueba imputado ha sido guardado en /content/drive/MyDrive/test_data_imputed.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/test_data_imputed.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Ajustar las opciones de visualización de pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las filas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las columnas</span>

<span class="c1"># Calcular el porcentaje de datos faltantes por columna</span>
<span class="n">missing_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">tes</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tes</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Crear un DataFrame con el nombre de la variable y el porcentaje de datos faltantes</span>
<span class="n">missing_data_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">tes</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="s1">&#39;Porcentaje de Datos Faltantes&#39;</span><span class="p">:</span> <span class="n">missing_percentage</span>
<span class="p">})</span>

<span class="c1"># Mostrar la tabla completa sin truncar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_data_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                Variable  Porcentaje de Datos Faltantes
customer_ID  customer_ID                            0.0
P_2                  P_2                            0.0
B_36                B_36                            0.0
R_28                R_28                            0.0
S_17                S_17                            0.0
D_93                D_93                            0.0
D_69                D_69                            0.0
S_23                S_23                            0.0
D_109              D_109                            0.0
D_140              D_140                            0.0
R_22                R_22                            0.0
D_124              D_124                            0.0
D_65                D_65                            0.0
B_32                B_32                            0.0
B_41                B_41                            0.0
S_12                S_12                            0.0
D_46                D_46                            0.0
R_10                R_10                            0.0
B_40                B_40                            0.0
B_27                B_27                            0.0
B_26                B_26                            0.0
D_83                D_83                            0.0
B_31                B_31                            0.0
R_14                R_14                            0.0
D_129              D_129                            0.0
D_91                D_91                            0.0
D_51                D_51                            0.0
P_3                  P_3                            0.0
B_10                B_10                            0.0
S_22                S_22                            0.0
B_6                  B_6                            0.0
R_18                R_18                            0.0
R_19                R_19                            0.0
D_52                D_52                            0.0
R_6                  R_6                            0.0
S_24                S_24                            0.0
D_128              D_128                            0.0
S_7                  S_7                            0.0
D_61                D_61                            0.0
R_7                  R_7                            0.0
B_12                B_12                            0.0
P_4                  P_4                            0.0
D_144              D_144                            0.0
S_6                  S_6                            0.0
S_27                S_27                            0.0
S_5                  S_5                            0.0
D_94                D_94                            0.0
D_123              D_123                            0.0
R_15                R_15                            0.0
S_19                S_19                            0.0
S_3                  S_3                            0.0
R_25                R_25                            0.0
D_78                D_78                            0.0
D_54                D_54                            0.0
D_71                D_71                            0.0
S_25                S_25                            0.0
S_11                S_11                            0.0
D_125              D_125                            0.0
D_41                D_41                            0.0
</pre></div>
</div>
</div>
</div>
<p>Luego de la imputacion completada con Iterative Imputer, procederemos a predecir las etiquetas del conjunto de test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>

<span class="c1"># ------ Crear el modelo GaussianNB ajustado con los hiperparámetros del archivo pickle ------</span>
<span class="k">def</span> <span class="nf">create_gaussian_nb_from_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">):</span>
    <span class="c1"># Cargar el archivo pickle</span>
    <span class="n">df_resultados_modelos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>

    <span class="c1"># Extraer los mejores hiperparámetros para GaussianNB</span>
    <span class="n">best_params_nb</span> <span class="o">=</span> <span class="n">df_resultados_modelos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_resultados_modelos</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;Mejores Hiperparámetros&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Crear el modelo GaussianNB ajustado con los hiperparámetros</span>
    <span class="n">nb_model</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">(</span><span class="n">var_smoothing</span><span class="o">=</span><span class="n">best_params_nb</span><span class="p">[</span><span class="s1">&#39;nb__var_smoothing&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">nb_model</span>

<span class="c1"># ------ Función para ajustar el modelo con los datos de entrenamiento ------</span>
<span class="k">def</span> <span class="nf">fit_gaussian_nb_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_data</span><span class="p">):</span>
    <span class="c1"># Asegurarse de que el train_data no tenga la columna &#39;customer_ID&#39; y &#39;target&#39;</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

    <span class="c1"># Ajustar (entrenar) el modelo con los datos de entrenamiento</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>  <span class="c1"># Devolver el modelo y las columnas utilizadas</span>

<span class="c1"># ------ Función para alinear columnas entre entrenamiento y prueba ------</span>
<span class="k">def</span> <span class="nf">align_test_columns</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">train_columns</span><span class="p">):</span>
    <span class="c1"># Asegurarse de que el test_data tenga las mismas columnas que el conjunto de entrenamiento</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">train_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">test_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Si falta alguna columna en el conjunto de prueba, agregarla con valor 0</span>

    <span class="c1"># Solo mantener las columnas que estaban en el conjunto de entrenamiento</span>
    <span class="k">return</span> <span class="n">test_data</span><span class="p">[</span><span class="n">train_columns</span><span class="p">]</span>

<span class="c1"># ------ Función para predecir las etiquetas en el conjunto de prueba y agregar la columna &#39;target&#39; ------</span>
<span class="k">def</span> <span class="nf">predict_test_data_and_add_target</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_columns</span><span class="p">):</span>
    <span class="c1"># Asegurarse de que el test_data no tenga la columna &#39;customer_ID&#39; y &#39;target&#39;</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;customer_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1"># Alinear las columnas del conjunto de prueba con las columnas del conjunto de entrenamiento</span>
    <span class="n">X_test_aligned</span> <span class="o">=</span> <span class="n">align_test_columns</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">train_columns</span><span class="p">)</span>

    <span class="c1"># Hacer las predicciones</span>
    <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_aligned</span><span class="p">)</span>  <span class="c1"># Agregar las predicciones como columna &#39;target&#39;</span>

    <span class="k">return</span> <span class="n">test_data</span>

<span class="c1"># ------ Función principal para predecir y guardar el conjunto de prueba con las predicciones ------</span>
<span class="k">def</span> <span class="nf">predict_and_save_test_data</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data_path</span><span class="p">,</span> <span class="n">pickle_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># Cargar el conjunto de prueba desde un archivo Feather</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">test_data_path</span><span class="p">)</span>

    <span class="c1"># Cargar el modelo GaussianNB ajustado con los mejores hiperparámetros</span>
    <span class="n">nb_model</span> <span class="o">=</span> <span class="n">create_gaussian_nb_from_pickle</span><span class="p">(</span><span class="n">pickle_path</span><span class="p">)</span>

    <span class="c1"># Ajustar (entrenar) el modelo con los datos de entrenamiento y obtener las columnas del entrenamiento</span>
    <span class="n">nb_model</span><span class="p">,</span> <span class="n">train_columns</span> <span class="o">=</span> <span class="n">fit_gaussian_nb_model</span><span class="p">(</span><span class="n">nb_model</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>

    <span class="c1"># Predecir las etiquetas en el conjunto de prueba y agregar la columna &#39;target&#39;</span>
    <span class="n">test_data_with_target</span> <span class="o">=</span> <span class="n">predict_test_data_and_add_target</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">nb_model</span><span class="p">,</span> <span class="n">train_columns</span><span class="p">)</span>

    <span class="c1"># Guardar el conjunto de prueba con la columna &#39;target&#39; en un archivo CSV</span>
    <span class="n">test_data_with_target</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El conjunto de prueba con las predicciones ha sido guardado en </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># ------ Ejecutar todo el proceso ------</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">dataset</span>  <span class="c1"># `dataset` ya debe estar cargado en memoria como un DataFrame</span>
<span class="n">test_data_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/test_data_imputed.csv&#39;</span>  <span class="c1"># Ruta al archivo de conjunto de prueba en formato Feather</span>
<span class="n">pickle_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/resultados_modelos.pkl&#39;</span>  <span class="c1"># Ruta al archivo pickle con los hiperparámetros</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/predicciones_test_gaussian.csv&#39;</span>  <span class="c1"># Ruta donde se guardará el conjunto de prueba con las predicciones</span>

<span class="c1"># Ejecutar la predicción y guardar el resultado</span>
<span class="n">predict_and_save_test_data</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data_path</span><span class="p">,</span> <span class="n">pickle_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El conjunto de prueba con las predicciones ha sido guardado en /content/drive/MyDrive/predicciones_test_gaussian.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/content/drive/MyDrive/predicciones_test_gaussian.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-bef6f637-4668-4a9c-9375-ef2e385e2f0c" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_ID</th>
      <th>P_2</th>
      <th>B_36</th>
      <th>R_28</th>
      <th>S_17</th>
      <th>D_93</th>
      <th>D_69</th>
      <th>S_23</th>
      <th>D_109</th>
      <th>D_140</th>
      <th>...</th>
      <th>S_3</th>
      <th>R_25</th>
      <th>D_78</th>
      <th>D_54</th>
      <th>D_71</th>
      <th>S_25</th>
      <th>S_11</th>
      <th>D_125</th>
      <th>D_41</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>0.6313</td>
      <td>0.008150</td>
      <td>0.005960</td>
      <td>0.005093</td>
      <td>0.000834</td>
      <td>0.633416</td>
      <td>0.1349</td>
      <td>0.005123</td>
      <td>0.004670</td>
      <td>...</td>
      <td>0.1687</td>
      <td>0.008446</td>
      <td>0.004356</td>
      <td>1.005</td>
      <td>0.014690</td>
      <td>0.9710</td>
      <td>1.882</td>
      <td>0.155526</td>
      <td>0.009970</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>0.5870</td>
      <td>0.000078</td>
      <td>0.001253</td>
      <td>0.007320</td>
      <td>0.008070</td>
      <td>0.689856</td>
      <td>0.1385</td>
      <td>0.000610</td>
      <td>0.004940</td>
      <td>...</td>
      <td>0.2413</td>
      <td>0.006348</td>
      <td>0.001506</td>
      <td>1.000</td>
      <td>0.011950</td>
      <td>0.9750</td>
      <td>2.043</td>
      <td>0.177318</td>
      <td>0.000166</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>0.6090</td>
      <td>0.000989</td>
      <td>0.001924</td>
      <td>0.006450</td>
      <td>0.004833</td>
      <td>0.534611</td>
      <td>0.1365</td>
      <td>0.006810</td>
      <td>0.002113</td>
      <td>...</td>
      <td>0.2670</td>
      <td>0.009020</td>
      <td>0.007587</td>
      <td>1.008</td>
      <td>0.015594</td>
      <td>0.9785</td>
      <td>1.642</td>
      <td>0.172647</td>
      <td>0.004196</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>0.6147</td>
      <td>0.000845</td>
      <td>0.006756</td>
      <td>0.001257</td>
      <td>0.007706</td>
      <td>0.296410</td>
      <td>0.1315</td>
      <td>0.006935</td>
      <td>0.006393</td>
      <td>...</td>
      <td>0.1890</td>
      <td>0.000756</td>
      <td>0.004433</td>
      <td>1.004</td>
      <td>0.008700</td>
      <td>0.9766</td>
      <td>1.002</td>
      <td>0.149395</td>
      <td>0.004124</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00000469ba478561f23a92a868bd366de6f6527a684c9a...</td>
      <td>0.5920</td>
      <td>0.001413</td>
      <td>0.003578</td>
      <td>0.002934</td>
      <td>0.000445</td>
      <td>0.007156</td>
      <td>0.1396</td>
      <td>0.001480</td>
      <td>0.004330</td>
      <td>...</td>
      <td>0.1800</td>
      <td>0.003849</td>
      <td>0.006240</td>
      <td>1.005</td>
      <td>0.009420</td>
      <td>0.9756</td>
      <td>1.082</td>
      <td>0.007618</td>
      <td>0.000732</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 60 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-bef6f637-4668-4a9c-9375-ef2e385e2f0c')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-bef6f637-4668-4a9c-9375-ef2e385e2f0c button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-bef6f637-4668-4a9c-9375-ef2e385e2f0c');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8fc7f547-dcb3-4a1f-b6b8-81680f322a91">
  <button class="colab-df-quickchart" onclick="quickchart('df-8fc7f547-dcb3-4a1f-b6b8-81680f322a91')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8fc7f547-dcb3-4a1f-b6b8-81680f322a91 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="informe.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><strong>Ejercicio 1.2: Research</strong></p>
      </div>
    </a>
    <a class="right-next"
       href="Ejercicio3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Ejercicio 3: Modelos de Regresión</strong></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-modulos-necesarios"><strong>Librerias  y modulos necesarios</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verificar-datos"><strong>Verificar datos</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-con-y-sin-adasyn"><strong>Modelos con y sin <em><strong>ADASYN</strong></em></strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion"><strong>Hiperparametrización</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluacion-de-modelos"><strong>Evaluación de modelos</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion-conjunto-de-test"><strong>Predicción Conjunto de Test</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kanery Marcela Camargo Rodríguez y Emanuel de Jesús Carbonell Naranjo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>